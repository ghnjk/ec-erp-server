import{r as D,M as q,_ as R,d as H,a as s,b as V,c as z,h as K,w as u,e,u as T,g as F,f as S,t as $,j as I,k as Q,l as pe,o as de,T as _e}from"./index.11abf68f.js";import{s as me,q as ve,d as W,e as L,f as he}from"./supplierApis.6d25968c.js";import{s as ge,a as fe,l as ee,b as te}from"./skuUtil.f8bc9a5a.js";const ue=D([]),Z=D([]);async function ye(){ue.value=[],Z.value=[];const A={current_page:1,page_size:1e4};try{const l=await me(A);ue.value=l.list,l.list.forEach(o=>{Z.value.push({label:o.supplier_name,value:o.supplier_id})})}catch(l){console.error(l),await q.error(`\u67E5\u8BE2\u4F9B\u5E94\u5546\u5F02\u5E38: ${l}`)}}function j(A){return A==null||A==="\u8349\u7A3F"?"\u9009\u8D2D":A==="\u4F9B\u5E94\u5546\u6361\u8D27\u4E2D"?"\u91C7\u8D2D\u5355\u786E\u8BA4":A==="\u5F85\u53D1\u8D27"?"\u53D1\u8D27":A==="\u6D77\u8FD0\u4E2D"?"\u70B9\u8D27\u5165\u5E93":A==="\u5DF2\u5165\u5E93"?"\u540C\u6B65erp":"\u4E0B\u4E00\u6B65"}const be=S("br",null,null,-1),ke={class:"table-container"},De=S("br",null,null,-1),we={name:"SelectPurchaseSkuDialog"},Ee=H({...we,emits:["onOrderChange"],setup(A,{expose:l,emit:o}){const a=new Intl.NumberFormat("zh-CN",{style:"currency",currency:"CNY"}),t=D(!1),n=D(null),c=D(null),m=D(""),g=D(""),r=[{width:120,colKey:"sku_group",title:"sku\u5206\u7EC4",align:"center"},{width:120,colKey:"sku_name",title:"\u5546\u54C1\u540D",align:"center"},{width:120,colKey:"sku",title:"\u5546\u54C1SKU",align:"center"},{width:120,colKey:"inventory",title:"\u5E93\u5B58",align:"center"},{width:120,colKey:"quantity",title:"\u6570\u91CF",align:"center",edit:{component:Q,props:{autofocus:!0},validateTrigger:"change",abortEditOnEvent:["onEnter","onBlur"],onEdited:v=>{console.log(v),i.value.splice(v.rowIndex,1,v.newRowData),k()},rules:[{required:!0,message:"\u4E0D\u80FD\u4E3A\u7A7A"}],defaultEditable:!0}},{width:120,colKey:"unit_price",title:"\u5355\u4EF7",align:"center",edit:{component:Q,props:{autofocus:!0},validateTrigger:"change",abortEditOnEvent:["onEnter","onBlur"],onEdited:v=>{console.log(v),i.value.splice(v.rowIndex,1,v.newRowData),k()},rules:[{required:!0,message:"\u4E0D\u80FD\u4E3A\u7A7A"}],defaultEditable:!1}},{width:120,colKey:"total_price",title:"\u603B\u4EF7",align:"center"}],i=D([]),b=D(0),d=async()=>{const v=fe.value.get(g.value);if(v!=null)for(let h=0;h<v.length;h++){const f=v[h],y={supplier_id:c.value,sku:f.sku},_=await ve(y);i.value.push({idx:i.value.length+1,sku_group:f.sku_group,sku_name:f.sku_name,sku:f.sku,erp_sku_image_url:f.erp_sku_image_url,inventory:f.inventory,quantity:0,unit_price:_.unit_price/100})}},p=async v=>{await ye(),await ee(),v!==null?(n.value=v,c.value=v.supplier_id,m.value=v.remark,i.value=[],v.purchase_skus.forEach(h=>{const f=te.value.get(h.sku);i.value.push({idx:i.value.length+1,sku_group:h.sku_group,sku_name:h.sku_name,sku:h.sku,erp_sku_image_url:f.erp_sku_image_url,inventory:f.inventory,quantity:h.quantity,unit_price:h.unit_price/100})})):(n.value=null,c.value=null,m.value="",i.value=[]),k(),t.value=!0},k=()=>{b.value=0,i.value.forEach(v=>{b.value+=v.quantity*v.unit_price})},C=()=>{let v={};return n.value===null?(v.purchase_order_id=-1,v.supplier_id=c.value,v.purchase_step="\u8349\u7A3F",v.remark=m.value):(v=n.value,v.supplier_id=c.value,v.remark=m.value),v.purchase_skus=[],i.value.forEach(h=>{const f=JSON.parse(JSON.stringify(h));f.unit_price=Math.round(f.unit_price*100),v.purchase_skus.push(f)}),v},B=async()=>{if(c.value<=0){await q.error("\u8BF7\u5148\u9009\u62E9\u4F9B\u5E94\u5546");return}const v=C();console.log("onSubmitPurchaseOrder ",v);try{const h=await W(v);console.log(h),t.value=!1,o("onOrderChange")}catch(h){console.error(h),await q.error(`\u4FDD\u5B58\u91C7\u8D2D\u5355\u5F02\u5E38: ${h}`)}},P=async()=>{if(c.value<=0){await q.error("\u8BF7\u5148\u9009\u62E9\u4F9B\u5E94\u5546");return}const v=C();console.log("onSavePurchaseOrder ",v);try{const h=await L(v);console.log(h),t.value=!1,o("onOrderChange")}catch(h){console.error(h),await q.error(`\u4FDD\u5B58\u91C7\u8D2D\u5355\u5F02\u5E38: ${h}`)}},x=({col:v,rowIndex:h,colIndex:f})=>{if(f!==0||h>0&&i.value[h-1].sku_group===i.value[h].sku_group)return;let y=1;for(let _=h+1;_<i.value.length&&i.value[_].sku_group===i.value[h].sku_group;_++)y+=1;if(!(y<=1))return console.log(`skuTableRowspanAndColspan ${h}-${f}`,{rowspan:y},i.value),{rowspan:y}};return l({popupDialog:p}),(v,h)=>{const f=s("t-select"),y=s("t-form-item"),_=s("t-form"),U=s("t-col"),w=s("t-button"),N=s("t-space"),M=s("t-row"),J=s("t-image"),G=s("t-table"),Y=s("t-textarea"),X=s("t-dialog");return V(),z("div",null,[t.value?(V(),K(X,{key:0,visible:t.value,"onUpdate:visible":h[3]||(h[3]=O=>t.value=O),"cancel-btn":null,"close-on-esc-keydown":!1,"close-on-overlay-click":!1,"confirm-btn":null,header:"\u9009\u62E9\u91C7\u8D2D\u5546\u54C1","show-overlay":"",width:"80%"},{default:u(()=>[e(M,null,{default:u(()=>[e(U,{span:12},{default:u(()=>[e(_,{layout:"inline"},{default:u(()=>[e(y,{label:"\u4F9B\u5E94\u5546:",name:"supplierId"},{default:u(()=>[e(f,{modelValue:c.value,"onUpdate:modelValue":h[0]||(h[0]=O=>c.value=O),options:T(Z),filterable:"",placeholder:"-\u8BF7\u9009\u62E9\u4F9B\u5E94\u5546-",style:{width:"200px",display:"inline-block",margin:"0 20px 20px 0"}},null,8,["modelValue","options"])]),_:1})]),_:1})]),_:1}),e(U,{span:8},{default:u(()=>[e(_,{layout:"inline"},{default:u(()=>[e(y,{label:"SKU\u5206\u7EC4:",name:"skuGroupName"},{default:u(()=>[e(f,{modelValue:g.value,"onUpdate:modelValue":h[1]||(h[1]=O=>g.value=O),options:T(ge),filterable:"",placeholder:"-\u8BF7\u9009\u62E9SKU\u5206\u7EC4-",style:{width:"200px",display:"inline-block",margin:"0 20px 20px 0"}},null,8,["modelValue","options"])]),_:1}),e(y,null,{default:u(()=>[e(N,{size:"small",style:{"align-items":"center"}},{default:u(()=>[e(w,{theme:"default",onClick:d},{default:u(()=>[F("\u6DFB\u52A0\u91C7\u8D2D")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(U,{span:4},{default:u(()=>[S("h2",null,"\u603B\u91D1\u989D\uFF1A"+$(T(a).format(b.value)),1)]),_:1})]),_:1}),be,S("div",ke,[e(G,{bordered:!0,columns:r,data:i.value,"rowspan-and-colspan":x,"lazy-load":"",resizable:"","row-key":"idx","table-layout":"fixed"},{total_price:u(({row:O})=>[F($(T(a).format(O.unit_price*O.quantity)),1)]),sku:u(({row:O})=>[e(N,null,{default:u(()=>[e(J,{src:O.erp_sku_image_url,style:{width:"30px",height:"30px"}},null,8,["src"]),F(" "+$(O.sku),1)]),_:2},1024)]),_:1},8,["data"]),De,e(M,null,{default:u(()=>[e(U,{span:12},{default:u(()=>[e(y,{label:"\u5907\u6CE8:",name:"remark"},{default:u(()=>[e(Y,{modelValue:m.value,"onUpdate:modelValue":h[2]||(h[2]=O=>m.value=O),autosize:{minRows:3,maxRows:10},name:"remark",placeholder:"\u91C7\u8D2D\u5355\u5907\u6CE8"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(M,null,{default:u(()=>[e(U,{span:9}),e(U,{span:3},{default:u(()=>[e(N,null,{default:u(()=>[e(w,{style:{float:"right"},theme:"primary",onClick:P},{default:u(()=>[F("\u4FDD\u5B58")]),_:1}),e(w,{style:{float:"right"},theme:"success",onClick:B},{default:u(()=>{var O;return[F(" > \u63D0\u4EA4\uFF1A"+$(T(j)((O=n.value)==null?void 0:O.purchase_step)),1)]}),_:1})]),_:1})]),_:1})]),_:1})])]),_:1},8,["visible"])):I("v-if",!0)])}}});var ae=R(Ee,[["__file","/Users/jkguo/workspace/ec-erp-static/src/pages/supply/components/purchase/selectPurchaseSkuDialog.vue"]]);const Ce={name:"InputShippingDialog"},Be=H({...Ce,emits:["onOrderChange"],setup(A,{expose:l,emit:o}){const a=D(!1),t=D(null),n=[{label:"\u4E49\u4E4C",value:"\u4E49\u4E4C"},{label:"\u5E7F\u5DDE",value:"\u5E7F\u5DDE"},{label:"\u664B\u6C5F",value:"\u664B\u6C5F"},{label:"\u65B0-\u4E49\u4E4C\u6D77\u8FD0",value:"\u65B0-\u4E49\u4E4C\u6D77\u8FD0"},{label:"\u6CB3\u5317",value:"\u6CB3\u5317"}],c=async r=>{if(t.value=r,t.value.expect_arrive_warehouse_date===void 0||t.value.expect_arrive_warehouse_date===null||t.value.expect_arrive_warehouse_date===""){const i=new Date,b=new Date(i.getTime()+30*24*60*60*1e3),d=b.getFullYear(),p=String(b.getMonth()+1).padStart(2,"0"),k=String(b.getDate()).padStart(2,"0");t.value.expect_arrive_warehouse_date=`${d}-${p}-${k}`}a.value=!0},m=async()=>{console.log("onSavePurchaseOrder ",t.value);try{const r=await L(t.value);console.log(r),a.value=!1,o("onOrderChange")}catch(r){console.error(r),await q.error(`\u4FDD\u5B58\u91C7\u8D2D\u5355\u5F02\u5E38: ${r}`)}},g=async()=>{console.log("onSubmitPurchaseOrder ",t.value);try{const r=await W(t.value);console.log(r),a.value=!1,o("onOrderChange")}catch(r){console.error(r),await q.error(`\u4FDD\u5B58\u91C7\u8D2D\u5355\u5F02\u5E38: ${r}`)}};return l({popupDialog:c}),(r,i)=>{const b=s("t-input"),d=s("t-form-item"),p=s("t-select"),k=s("t-date-picker"),C=s("t-form"),B=s("t-col"),P=s("t-button"),x=s("t-space"),v=s("t-row"),h=s("t-dialog");return V(),z("div",null,[a.value?(V(),K(h,{key:0,visible:a.value,"onUpdate:visible":i[7]||(i[7]=f=>a.value=f),"cancel-btn":null,"close-on-esc-keydown":!1,"close-on-overlay-click":!1,"confirm-btn":null,header:"\u4F9B\u5E94\u5546\u53D1\u8D27","show-overlay":"",width:"60%"},{default:u(()=>[e(C,null,{default:u(()=>[e(d,{label:"\u91C7\u8D2D\u5355:",name:"purchase_order_id"},{default:u(()=>[e(b,{modelValue:t.value.purchase_order_id,"onUpdate:modelValue":i[0]||(i[0]=f=>t.value.purchase_order_id=f),disabled:""},null,8,["modelValue"])]),_:1}),e(d,{label:"\u4F9B\u5E94\u5546:",name:"supplier_name"},{default:u(()=>[e(b,{modelValue:t.value.supplier_name,"onUpdate:modelValue":i[1]||(i[1]=f=>t.value.supplier_name=f),disabled:""},null,8,["modelValue"])]),_:1}),e(d,{label:"\u91C7\u8D2D\u65E5\u671F:",name:"purchase_date"},{default:u(()=>[e(b,{modelValue:t.value.purchase_date,"onUpdate:modelValue":i[2]||(i[2]=f=>t.value.purchase_date=f),disabled:""},null,8,["modelValue"])]),_:1}),e(d,{label:"\u6D77\u8FD0\u516C\u53F8:",name:"shipping_company"},{default:u(()=>[e(b,{modelValue:t.value.shipping_company,"onUpdate:modelValue":i[3]||(i[3]=f=>t.value.shipping_company=f)},null,8,["modelValue"])]),_:1}),e(d,{label:"\u6E2F\u53E3:",name:"maritime_port"},{default:u(()=>[e(p,{modelValue:t.value.maritime_port,"onUpdate:modelValue":i[4]||(i[4]=f=>t.value.maritime_port=f),options:n,filterable:"",placeholder:"-\u8BF7\u9009\u62E9\u6E2F\u53E3-"},null,8,["modelValue"])]),_:1}),e(d,{label:"\u8FD0\u8D39:",name:"shipping_fee"},{default:u(()=>[e(b,{modelValue:t.value.shipping_fee,"onUpdate:modelValue":i[5]||(i[5]=f=>t.value.shipping_fee=f)},null,8,["modelValue"])]),_:1}),e(d,{label:"\u9884\u671F\u62B5\u8FBE\u65E5\u671F:",name:"expect_arrive_warehouse_date"},{default:u(()=>[e(k,{modelValue:t.value.expect_arrive_warehouse_date,"onUpdate:modelValue":i[6]||(i[6]=f=>t.value.expect_arrive_warehouse_date=f),"allow-input":""},null,8,["modelValue"])]),_:1})]),_:1}),e(v,null,{default:u(()=>[e(B,{span:9}),e(B,{span:3},{default:u(()=>[e(x,null,{default:u(()=>[e(P,{style:{float:"right"},theme:"primary",onClick:m},{default:u(()=>[F("\u4FDD\u5B58")]),_:1}),e(P,{style:{float:"right"},theme:"success",onClick:g},{default:u(()=>{var f;return[F(" > \u63D0\u4EA4\uFF1A"+$(T(j)((f=t.value)==null?void 0:f.purchase_step)),1)]}),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["visible"])):I("v-if",!0)])}}});var ne=R(Be,[["__file","/Users/jkguo/workspace/ec-erp-static/src/pages/supply/components/purchase/inputShippingDialog.vue"]]);const Fe=S("br",null,null,-1),xe={class:"table-container"},Ae={key:0,style:{"background-color":"yellow"}},Oe={key:1},Ve=S("br",null,null,-1),Se={name:"CheckInWareHouseDialog\u2022"},Pe=H({...Se,emits:["onOrderChange"],setup(A,{expose:l,emit:o}){const a=D([]),t=D(!1),n=D(null),c=[{width:120,colKey:"sku_group",title:"sku\u5206\u7EC4",align:"center"},{width:120,colKey:"sku_name",title:"\u5546\u54C1\u540D",align:"center"},{width:120,colKey:"sku",title:"\u5546\u54C1SKU",align:"center"},{width:120,colKey:"quantity",title:"\u91C7\u8D2D\u6570\u91CF",align:"center"},{width:120,colKey:"check_in_quantity",title:"\u5165\u5E93\u6570\u91CF",align:"center",edit:{component:Q,props:{autofocus:!0},validateTrigger:"change",abortEditOnEvent:["onEnter","onBlur"],onEdited:d=>{console.log(d),a.value.splice(d.rowIndex,1,d.newRowData)},rules:[{required:!0,message:"\u4E0D\u80FD\u4E3A\u7A7A"}],defaultEditable:!0}}],m=async d=>{await ee(),console.log(d),n.value=d,a.value=[],n.value.store_skus.forEach(p=>{const k=te.value.get(p.sku);a.value.push({idx:a.value.length+1,sku_group:p.sku_group,sku_name:p.sku_name,sku:p.sku,erp_sku_image_url:k.erp_sku_image_url,unit_price:p.unit_price,quantity:p.quantity,check_in_quantity:p.check_in_quantity})}),t.value=!0},g=()=>(n.value.store_skus=a.value,n.value),r=async()=>{const d=g();console.log("onSavePurchaseOrder ",d);try{const p=await L(d);console.log(p),t.value=!1,o("onOrderChange")}catch(p){console.error(p),await q.error(`\u4FDD\u5B58\u91C7\u8D2D\u5355\u5F02\u5E38: ${p}`)}},i=async()=>{const d=g();console.log("onSubmitPurchaseOrder ",d);try{const p=await W(d);console.log(p),t.value=!1,o("onOrderChange")}catch(p){console.error(p),await q.error(`\u4FDD\u5B58\u91C7\u8D2D\u5355\u5F02\u5E38: ${p}`)}},b=({col:d,rowIndex:p,colIndex:k})=>{if(k!==0||p>0&&a.value[p-1].sku_group===a.value[p].sku_group)return;let C=1;for(let B=p+1;B<a.value.length&&a.value[B].sku_group===a.value[p].sku_group;B++)C+=1;if(!(C<=1))return console.log(`skuTableRowspanAndColspan ${p}-${k}`,{rowspan:C},a.value),{rowspan:C}};return l({popupDialog:m}),(d,p)=>{const k=s("t-input"),C=s("t-form-item"),B=s("t-form"),P=s("t-col"),x=s("t-row"),v=s("t-image"),h=s("t-space"),f=s("t-table"),y=s("t-textarea"),_=s("t-button"),U=s("t-dialog");return V(),z("div",null,[t.value?(V(),K(U,{key:0,visible:t.value,"onUpdate:visible":p[4]||(p[4]=w=>t.value=w),"cancel-btn":null,"close-on-esc-keydown":!1,"close-on-overlay-click":!1,"confirm-btn":null,header:"\u70B9\u8D27\u5165\u5E93","show-overlay":"",width:"80%"},{default:u(()=>[e(x,null,{default:u(()=>[e(P,{span:12},{default:u(()=>[e(B,{layout:"inline"},{default:u(()=>[e(C,{label:"\u91C7\u8D2D\u5355:",name:"purchase_order_id"},{default:u(()=>[e(k,{modelValue:n.value.purchase_order_id,"onUpdate:modelValue":p[0]||(p[0]=w=>n.value.purchase_order_id=w),disabled:""},null,8,["modelValue"])]),_:1}),e(C,{label:"\u4F9B\u5E94\u5546:",name:"supplier_name"},{default:u(()=>[e(k,{modelValue:n.value.supplier_name,"onUpdate:modelValue":p[1]||(p[1]=w=>n.value.supplier_name=w),disabled:""},null,8,["modelValue"])]),_:1}),e(C,{label:"\u91C7\u8D2D\u65E5\u671F:",name:"purchase_date"},{default:u(()=>[e(k,{modelValue:n.value.purchase_date,"onUpdate:modelValue":p[2]||(p[2]=w=>n.value.purchase_date=w),disabled:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),Fe,S("div",xe,[e(f,{bordered:!0,columns:c,data:a.value,"rowspan-and-colspan":b,"lazy-load":"",resizable:"","row-key":"idx","table-layout":"fixed"},{quantity:u(({row:w})=>[w.quantity!==w.check_in_quantity?(V(),z("div",Ae,$(w.quantity),1)):(V(),z("div",Oe,$(w.quantity),1))]),sku:u(({row:w})=>[e(h,null,{default:u(()=>[e(v,{src:w.erp_sku_image_url,style:{width:"30px",height:"30px"}},null,8,["src"]),F(" "+$(w.sku),1)]),_:2},1024)]),_:1},8,["data"]),Ve,e(x,null,{default:u(()=>[e(P,{span:12},{default:u(()=>[e(C,{label:"\u5907\u6CE8:",name:"remark"},{default:u(()=>[e(y,{modelValue:n.value.remark,"onUpdate:modelValue":p[3]||(p[3]=w=>n.value.remark=w),autosize:{minRows:3,maxRows:10},name:"remark",placeholder:"\u91C7\u8D2D\u5355\u5907\u6CE8"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(x,null,{default:u(()=>[e(P,{span:9}),e(P,{span:3},{default:u(()=>[e(h,null,{default:u(()=>[e(_,{style:{float:"right"},theme:"primary",onClick:r},{default:u(()=>[F("\u4FDD\u5B58")]),_:1}),e(_,{style:{float:"right"},theme:"success",onClick:i},{default:u(()=>{var w;return[F(" > \u63D0\u4EA4\uFF1A"+$(T(j)((w=n.value)==null?void 0:w.purchase_step)),1)]}),_:1})]),_:1})]),_:1})]),_:1})])]),_:1},8,["visible"])):I("v-if",!0)])}}});var oe=R(Pe,[["__file","/Users/jkguo/workspace/ec-erp-static/src/pages/supply/components/purchase/checkInWareHouseDialog.vue"]]);class $e{constructor(l){this.standards={strict:"strict",loose:"loose",html5:"html5"},this.previewBody=null,this.close=null,this.previewBodyUtilPrintBtn=null,this.selectArray=[],this.counter=0,this.settings={standard:this.standards.html5},Object.assign(this.settings,l),this.init()}init(){this.counter++,this.settings.id=`printArea_${this.counter}`;let l="";this.settings.url&&!this.settings.asyncUrl&&(l=this.settings.url);let o=this;if(this.settings.asyncUrl)return void o.settings.asyncUrl(function(t){let n=o.getPrintWindow(t);o.settings.preview?o.previewIfrmaeLoad():o.print(n)},o.settings.vue);let a=this.getPrintWindow(l);this.settings.url||this.write(a.doc),this.settings.preview?this.previewIfrmaeLoad():this.print(a)}addEvent(l,o,a){l.addEventListener?l.addEventListener(o,a,!1):l.attachEvent?l.attachEvent("on"+o,a):l["on"+o]=a}previewIfrmaeLoad(){let l=document.getElementById("vue-pirnt-nb-previewBox");if(l){let o=this,a=l.querySelector("iframe");this.settings.previewBeforeOpenCallback(),this.addEvent(a,"load",function(){o.previewBoxShow(),o.removeCanvasImg(),o.settings.previewOpenCallback()}),this.addEvent(l.querySelector(".previewBodyUtilPrintBtn"),"click",function(){o.settings.beforeOpenCallback(),o.settings.openCallback(),a.contentWindow.print(),o.settings.closeCallback()})}}removeCanvasImg(){let l=this;try{if(l.elsdom){let o=l.elsdom.querySelectorAll(".canvasImg");for(let a=0;a<o.length;a++)o[a].remove()}}catch(o){console.log(o)}}print(l){var o=this;let a=document.getElementById(this.settings.id)||l.f,t=document.getElementById(this.settings.id).contentWindow||l.f.contentWindow;o.settings.beforeOpenCallback(),o.addEvent(a,"load",function(){t.focus(),o.settings.openCallback(),t.print(),a.remove(),o.settings.closeCallback(),o.removeCanvasImg()})}write(l){l.open(),l.write(`${this.docType()}<html>${this.getHead()}${this.getBody()}</html>`),l.close()}docType(){return this.settings.standard===this.standards.html5?"<!DOCTYPE html>":`<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01${this.settings.standard===this.standards.loose?" Transitional":""}//EN" "http://www.w3.org/TR/html4/${this.settings.standard===this.standards.loose?"loose":"strict"}.dtd">`}getHead(){let l="",o="",a="";this.settings.extraHead&&this.settings.extraHead.replace(/([^,]+)/g,n=>{l+=n}),[].forEach.call(document.querySelectorAll("link"),function(n){n.href.indexOf(".css")>=0&&(o+=`<link type="text/css" rel="stylesheet" href="${n.href}" >`)});let t=document.styleSheets;if(t&&t.length>0)for(let n=0;n<t.length;n++)try{if(t[n].cssRules||t[n].rules){let c=t[n].cssRules||t[n].rules;for(let m=0;m<c.length;m++)a+=c[m].cssText}}catch(c){console.log(t[n].href+c)}return this.settings.extraCss&&this.settings.extraCss.replace(/([^,\s]+)/g,n=>{o+=`<link type="text/css" rel="stylesheet" href="${n}">`}),`<head><title>${this.settings.popTitle}</title>${l}${o}<style type="text/css">${a}</style></head>`}getBody(){let l=this.settings.ids;return l=l.replace(new RegExp("#","g"),""),this.elsdom=this.beforeHanler(document.getElementById(l)),"<body>"+this.getFormData(this.elsdom).outerHTML+"</body>"}beforeHanler(l){let o=l.querySelectorAll("canvas");for(let a=0;a<o.length;a++)if(!o[a].style.display){let t=o[a].parentNode,n=o[a].toDataURL("image/png"),c=new Image;c.className="canvasImg",c.style.display="none",c.src=n,t.appendChild(c)}return l}getFormData(l){let o=l.cloneNode(!0),a=o.querySelectorAll("input,select,textarea"),t=o.querySelectorAll(".canvasImg,canvas"),n=-1;for(let c=0;c<t.length;c++){let m=t[c].parentNode,g=t[c];g.tagName.toLowerCase()==="canvas"?m.removeChild(g):g.style.display="block"}for(let c=0;c<a.length;c++){let m=a[c],g=m.getAttribute("type"),r=a[c];if(g||(g=m.tagName==="SELECT"?"select":m.tagName==="TEXTAREA"?"textarea":""),m.tagName==="INPUT")g==="radio"||g==="checkbox"?m.checked&&r.setAttribute("checked",m.checked):(r.value=m.value,r.setAttribute("value",m.value));else if(g==="select"){n++;for(let i=0;i<l.querySelectorAll("select").length;i++){let b=l.querySelectorAll("select")[i];if(!b.getAttribute("newbs")&&b.setAttribute("newbs",i),b.getAttribute("newbs")==n){let d=l.querySelectorAll("select")[n].selectedIndex;m.options[d].setAttribute("selected",!0)}}}else r.innerHTML=m.value,r.setAttribute("html",m.value)}return o}getPrintWindow(l){var o=this.Iframe(l);return{f:o,win:o.contentWindow||o,doc:o.doc}}previewBoxShow(){let l=document.getElementById("vue-pirnt-nb-previewBox");l&&(document.querySelector("html").setAttribute("style","overflow: hidden"),l.style.display="block")}previewBoxHide(){let l=document.getElementById("vue-pirnt-nb-previewBox");l&&(document.querySelector("html").setAttribute("style","overflow: visible;"),l.querySelector("iframe")&&l.querySelector("iframe").remove(),l.style.display="none")}previewBox(){let l=document.getElementById("vue-pirnt-nb-previewBox"),o="previewBody";if(l)return l.querySelector("iframe")&&l.querySelector("iframe").remove(),{close:l.querySelector(".previewClose"),previewBody:l.querySelector(".previewBody")};let a=document.createElement("div");a.setAttribute("id","vue-pirnt-nb-previewBox"),a.setAttribute("style","position: fixed;top: 0px;left: 0px;width: 100%;height: 100%;background: white;display:none"),a.style.zIndex=this.settings.zIndex;let t=document.createElement("div");t.setAttribute("class","previewHeader"),t.setAttribute("style","padding: 5px 20px;"),t.innerHTML=this.settings.previewTitle,a.appendChild(t),this.close=document.createElement("div");let n=this.close;n.setAttribute("class","previewClose"),n.setAttribute("style","position: absolute;top: 5px;right: 20px;width: 25px;height: 20px;cursor: pointer;");let c=document.createElement("div"),m=document.createElement("div");c.setAttribute("class","closeBefore"),c.setAttribute("style","position: absolute;width: 3px;height: 100%;background: #040404;transform: rotate(45deg); top: 0px;left: 50%;"),m.setAttribute("class","closeAfter"),m.setAttribute("style","position: absolute;width: 3px;height: 100%;background: #040404;transform: rotate(-45deg); top: 0px;left: 50%;"),n.appendChild(c),n.appendChild(m),t.appendChild(n),this.previewBody=document.createElement("div");let g=this.previewBody;g.setAttribute("class",o),g.setAttribute("style","display: flex;flex-direction: column; height: 100%;"),a.appendChild(g);let r=document.createElement("div");r.setAttribute("class","previewBodyUtil"),r.setAttribute("style","height: 32px;background: #474747;position: relative;"),g.appendChild(r),this.previewBodyUtilPrintBtn=document.createElement("div");let i=this.previewBodyUtilPrintBtn;return i.setAttribute("class","previewBodyUtilPrintBtn"),i.innerHTML=this.settings.previewPrintBtnLabel,i.setAttribute("style","position: absolute;padding: 2px 10px;margin-top: 3px;left: 24px;font-size: 14px;color: white;cursor: pointer;background-color: rgba(0,0,0,.12);background-image: linear-gradient(hsla(0,0%,100%,.05),hsla(0,0%,100%,0));background-clip: padding-box;border: 1px solid rgba(0,0,0,.35);border-color: rgba(0,0,0,.32) rgba(0,0,0,.38) rgba(0,0,0,.42);box-shadow: inset 0 1px 0 hsla(0,0%,100%,.05), inset 0 0 1px hsla(0,0%,100%,.15), 0 1px 0 hsla(0,0%,100%,.05);"),r.appendChild(i),document.body.appendChild(a),{close:this.close,previewBody:this.previewBody}}iframeBox(l,o){let a=document.createElement("iframe");return a.style.border="0px",a.style.position="absolute",a.style.width="0px",a.style.height="0px",a.style.right="0px",a.style.top="0px",a.setAttribute("id",l),a.setAttribute("src",o),a}Iframe(l){let o=this.settings.id;l=l||new Date().getTime();let a=this,t=this.iframeBox(o,l);try{if(this.settings.preview){t.setAttribute("style","border: 0px;flex: 1;");let n=this.previewBox(),c=n.previewBody,m=n.close;c.appendChild(t),this.addEvent(m,"click",function(){a.previewBoxHide()})}else document.body.appendChild(t);t.doc=null,t.doc=t.contentDocument?t.contentDocument:t.contentWindow?t.contentWindow.document:t.document}catch(n){throw new Error(n+". iframes may not be supported in this browser.")}if(t.doc==null)throw new Error("Cannot find document.");return t}}var se={directiveName:"print",mounted(A,l,o){let a=l.instance,t="";var n,c,m;c="click",m=()=>{if(typeof l.value=="string")t=l.value;else{if(typeof l.value!="object"||!l.value.id)return void window.print();{t=l.value.id;let r=t.replace(new RegExp("#","g"),"");document.getElementById(r)||(console.log("id in Error"),t="")}}g()},(n=A).addEventListener?n.addEventListener(c,m,!1):n.attachEvent?n.attachEvent("on"+c,m):n["on"+c]=m;const g=()=>{new $e({ids:t,vue:a,url:l.value.url,standard:"",extraHead:l.value.extraHead,extraCss:l.value.extraCss,zIndex:l.value.zIndex||20002,previewTitle:l.value.previewTitle||"\u6253\u5370\u9884\u89C8",previewPrintBtnLabel:l.value.previewPrintBtnLabel||"\u6253\u5370",popTitle:l.value.popTitle,preview:l.value.preview||!1,asyncUrl:l.value.asyncUrl,previewBeforeOpenCallback(){l.value.previewBeforeOpenCallback&&l.value.previewBeforeOpenCallback(a)},previewOpenCallback(){l.value.previewOpenCallback&&l.value.previewOpenCallback(a)},openCallback(){l.value.openCallback&&l.value.openCallback(a)},closeCallback(){l.value.closeCallback&&l.value.closeCallback(a)},beforeOpenCallback(){l.value.beforeOpenCallback&&l.value.beforeOpenCallback(a)}})}},install:function(A){A.directive("print",se)}};const qe={id:"printDiv"},Ue=S("br",null,null,-1),Te={class:"table-container"},Ne=S("br",null,null,-1),Ke=S("hr",null,null,-1),ze=S("br",null,null,-1),Ie={name:"PrintPurchaseOrderDialog\u2022"};var Le=H({...Ie,setup(A,{expose:l}){const o=se,a=D({id:"printDiv"}),t=D([]),n=D(!1),c=D(null),m=[{width:120,colKey:"sku_group",title:"sku\u5206\u7EC4",align:"center"},{width:120,colKey:"sku_name",title:"\u5546\u54C1\u540D",align:"center"},{width:120,colKey:"sku",title:"\u5546\u54C1SKU",align:"center"},{width:120,colKey:"quantity",title:"\u91C7\u8D2D\u6570\u91CF",align:"center"}],g=async b=>{await ee(),console.log(b),c.value=b,t.value=[],c.value.purchase_skus.forEach(d=>{const p=te.value.get(d.sku);t.value.push({idx:t.value.length+1,sku_group:d.sku_group,sku_name:d.sku_name,sku:d.sku,erp_sku_image_url:p.erp_sku_image_url,quantity:d.quantity})}),n.value=!0},r=({col:b,rowIndex:d,colIndex:p})=>{if(p!==0||d>0&&t.value[d-1].sku_group===t.value[d].sku_group)return;let k=1;for(let C=d+1;C<t.value.length&&t.value[C].sku_group===t.value[d].sku_group;C++)k+=1;if(!(k<=1))return console.log(`skuTableRowspanAndColspan ${d}-${p}`,{rowspan:k},t.value),{rowspan:k}},i=()=>{};return l({popupDialog:g}),(b,d)=>{const p=s("t-input"),k=s("t-form-item"),C=s("t-form"),B=s("t-col"),P=s("t-row"),x=s("t-image"),v=s("t-space"),h=s("t-table"),f=s("t-button"),y=s("t-dialog");return V(),z("div",null,[n.value?(V(),K(y,{key:0,visible:n.value,"onUpdate:visible":d[3]||(d[3]=_=>n.value=_),"cancel-btn":null,"confirm-btn":null,header:"\u6253\u5370\u91C7\u8D2D\u5355","show-overlay":"",width:"80%",onConfirm:i},{default:u(()=>[S("div",qe,[e(P,null,{default:u(()=>[e(B,{span:12},{default:u(()=>[e(C,{layout:"inline"},{default:u(()=>[e(k,{label:"\u91C7\u8D2D\u5355:",name:"purchase_order_id"},{default:u(()=>[e(p,{modelValue:c.value.purchase_order_id,"onUpdate:modelValue":d[0]||(d[0]=_=>c.value.purchase_order_id=_),disabled:""},null,8,["modelValue"])]),_:1}),e(k,{label:"\u4F9B\u5E94\u5546:",name:"supplier_name"},{default:u(()=>[e(p,{modelValue:c.value.supplier_name,"onUpdate:modelValue":d[1]||(d[1]=_=>c.value.supplier_name=_),disabled:""},null,8,["modelValue"])]),_:1}),e(k,{label:"\u91C7\u8D2D\u65E5\u671F:",name:"purchase_date"},{default:u(()=>[e(p,{modelValue:c.value.purchase_date,"onUpdate:modelValue":d[2]||(d[2]=_=>c.value.purchase_date=_),disabled:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),Ue,S("div",Te,[e(h,{bordered:!0,columns:m,data:t.value,"rowspan-and-colspan":r,"lazy-load":"",resizable:"","row-key":"idx","table-layout":"fixed"},{sku:u(({row:_})=>[e(v,null,{default:u(()=>[e(x,{src:_.erp_sku_image_url,style:{width:"30px",height:"30px"}},null,8,["src"]),F(" "+$(_.sku),1)]),_:2},1024)]),_:1},8,["data"])])]),Ne,Ke,ze,pe((V(),K(f,{style:{float:"right"},theme:"primary"},{default:u(()=>[F(" \u6253\u5370")]),_:1})),[[T(o),a.value]])]),_:1},8,["visible"])):I("v-if",!0)])}}}),re=R(Le,[["__file","/Users/jkguo/workspace/ec-erp-static/src/pages/supply/components/purchase/printPurchaseOrderDialog.vue"]]);const Re=S("br",null,null,-1),He={name:"PayDialog"},Me=H({...He,emits:["onOrderChange"],setup(A,{expose:l,emit:o}){const a=D(!1),t=D(null),n=async g=>{g.pay_amount/=100,t.value=g,a.value=!0},c=async()=>{const g=JSON.parse(JSON.stringify(t.value));g.pay_amount=Math.round(g.pay_amount*100),console.log("onSavePurchaseOrder ",g);try{const r=await L(g);console.log(r),a.value=!1,o("onOrderChange")}catch(r){console.error(r),await q.error(`\u4FDD\u5B58\u91C7\u8D2D\u5355\u5F02\u5E38: ${r}`)}},m=async()=>{const g=JSON.parse(JSON.stringify(t.value));g.pay_amount=Math.round(g.pay_amount*100),g.pay_state=1,console.log("onSubmitPurchaseOrder ",g);try{const r=await L(g);console.log(r),a.value=!1,o("onOrderChange")}catch(r){console.error(r),await q.error(`\u4FDD\u5B58\u91C7\u8D2D\u5355\u5F02\u5E38: ${r}`)}};return l({popupDialog:n}),(g,r)=>{const i=s("t-input"),b=s("t-form-item"),d=s("t-form"),p=s("t-col"),k=s("t-button"),C=s("t-space"),B=s("t-row"),P=s("t-dialog");return V(),z("div",null,[a.value?(V(),K(P,{key:0,visible:a.value,"onUpdate:visible":r[4]||(r[4]=x=>a.value=x),"cancel-btn":null,"close-on-esc-keydown":!1,"close-on-overlay-click":!1,"confirm-btn":null,header:"\u652F\u4ED8\u8D27\u6B3E","show-overlay":"",width:"60%"},{default:u(()=>[e(d,null,{default:u(()=>[e(b,{label:"\u91C7\u8D2D\u5355:",name:"purchase_order_id"},{default:u(()=>[e(i,{modelValue:t.value.purchase_order_id,"onUpdate:modelValue":r[0]||(r[0]=x=>t.value.purchase_order_id=x),disabled:""},null,8,["modelValue"])]),_:1}),e(b,{label:"\u4F9B\u5E94\u5546:",name:"supplier_name"},{default:u(()=>[e(i,{modelValue:t.value.supplier_name,"onUpdate:modelValue":r[1]||(r[1]=x=>t.value.supplier_name=x),disabled:""},null,8,["modelValue"])]),_:1}),e(b,{label:"\u91C7\u8D2D\u65E5\u671F:",name:"purchase_date"},{default:u(()=>[e(i,{modelValue:t.value.purchase_date,"onUpdate:modelValue":r[2]||(r[2]=x=>t.value.purchase_date=x),disabled:""},null,8,["modelValue"])]),_:1}),e(b,{label:"sku\u603B\u4EF7:",name:"sku_amount"},{default:u(()=>[F($(t.value.sku_amount/100),1)]),_:1}),e(b,{label:"\u4ED8\u6B3E\u91D1\u989D:",name:"pay_amount"},{default:u(()=>[e(i,{modelValue:t.value.pay_amount,"onUpdate:modelValue":r[3]||(r[3]=x=>t.value.pay_amount=x)},null,8,["modelValue"])]),_:1})]),_:1}),Re,e(B,null,{default:u(()=>[e(p,{span:9}),e(p,{span:3},{default:u(()=>[e(C,null,{default:u(()=>[e(k,{style:{float:"right"},theme:"primary",onClick:c},{default:u(()=>[F("\u4FDD\u5B58")]),_:1}),e(k,{style:{float:"right"},theme:"success",onClick:m},{default:u(()=>[F(" > \u652F\u4ED8\u8D27\u6B3E")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["visible"])):I("v-if",!0)])}}});var ie=R(Me,[["__file","/Users/jkguo/workspace/ec-erp-static/src/pages/supply/components/purchase/payDialog.vue"]]);const We=S("br",null,null,-1),je={class:"table-container"},Je={name:"PurchaseOrderList",components:{SelectPurchaseSkuDialog:ae,InputShippingDialog:ne,CheckInWareHouseDialog:oe,PrintPurchaseOrderDialog:re,PayDialog:ie}},Ge=H({...Je,setup(A){const l=new Intl.NumberFormat("zh-CN",{style:"currency",currency:"CNY"}),o=[{width:40,colKey:"purchase_order_id",title:"\u91C7\u8D2D\u5355",align:"center"},{width:60,colKey:"supplier_name",title:"\u4F9B\u5E94\u5546",align:"center"},{width:60,colKey:"purchase_date",title:"\u91C7\u8D2D\u65E5\u671F",align:"center"},{width:60,colKey:"purchase_step",title:"\u91C7\u8D2D\u8FDB\u5EA6",align:"center"},{width:40,colKey:"maritime_port",title:"\u56FD\u5185\u6E2F\u53E3",align:"center"},{width:60,colKey:"expect_arrive_warehouse_date",title:"\u9884\u8BA1\u5230\u8D27\u65E5\u671F",align:"center"},{width:80,colKey:"sku_amount",title:"sku\u603B\u4EF7",align:"center"},{width:80,colKey:"pay_state",title:"\u652F\u4ED8\u72B6\u6001",align:"center"},{width:120,colKey:"remark",title:"\u5907\u6CE8",align:"center",edit:{component:_e,props:{autofocus:!0},validateTrigger:"change",abortEditOnEvent:["onEnter","onBlur"],onEdited:async y=>{console.log(y),await L(y.newRowData),await B()},rules:[{required:!0,message:"\u4E0D\u80FD\u4E3A\u7A7A"}],defaultEditable:!1}},{width:100,colKey:"op",title:"\u64CD\u4F5C",align:"center"}],a=D([]),t=D(!1),n=D(1),c=D(0),m=D(10),g=[10,20,50,100],r=D({supplier_name:"",purchase_state:"",maritime_port:""}),i=D(null),b=D(null),d=D(null),p=D(null),k=D(null);de(()=>{B()});const C=({current:y,pageSize:_})=>{n.value=y,m.value=_,B()},B=async()=>{const y={current_page:n.value,page_size:m.value};t.value=!0;try{const _=await he(y);c.value=_.total,a.value=_.list}catch(_){console.error(_),await q.error(`\u67E5\u8BE2\u8BA2\u5355\u5F02\u5E38: ${_}`)}t.value=!1},P=()=>{i.value.popupDialog(null)},x=async y=>{t.value=!0;try{await W(y),await B()}catch(_){console.log(`\u540C\u6B65ERP\u5F02\u5E38:${_}`),await q.error(`\u540C\u6B65ERP\u5F02\u5E38:${_}`)}},v=async y=>{console.log(`\u5F53\u524D\u72B6\u6001\uFF1A ${y.purchase_step}`),y.purchase_step==="\u8349\u7A3F"||y.purchase_step==="\u4F9B\u5E94\u5546\u6361\u8D27\u4E2D"?i.value.popupDialog(y):y.purchase_step==="\u5F85\u53D1\u8D27"?b.value.popupDialog(y):y.purchase_step==="\u6D77\u8FD0\u4E2D"?d.value.popupDialog(y):y.purchase_step==="\u5DF2\u5165\u5E93"&&await x(y)},h=y=>{p.value.popupDialog(y)},f=y=>{k.value.popupDialog(y)};return(y,_)=>{const U=s("t-input"),w=s("t-form-item"),N=s("t-button"),M=s("t-space"),J=s("t-form"),G=s("t-col"),Y=s("t-row"),X=s("t-table"),O=s("t-pagination"),ce=s("t-card");return V(),z("div",null,[e(ce,null,{default:u(()=>[e(Y,null,{default:u(()=>[e(G,{span:12},{default:u(()=>[e(J,{layout:"inline"},{default:u(()=>[e(w,{label:"\u4F9B\u5E94\u5546:",name:"supplier_name"},{default:u(()=>[e(U,{modelValue:r.value.supplier_name,"onUpdate:modelValue":_[0]||(_[0]=E=>r.value.supplier_name=E),placeholder:"\u4F9B\u5E94\u5546"},null,8,["modelValue"])]),_:1}),e(w,{label:"\u91C7\u8D2D\u8FDB\u5EA6:",name:"purchase_state"},{default:u(()=>[e(U,{modelValue:r.value.purchase_state,"onUpdate:modelValue":_[1]||(_[1]=E=>r.value.purchase_state=E),placeholder:"\u91C7\u8D2D\u8FDB\u5EA6"},null,8,["modelValue"])]),_:1}),e(w,{label:"\u56FD\u5185\u6E2F\u53E3:",name:"maritime_port"},{default:u(()=>[e(U,{modelValue:r.value.maritime_port,"onUpdate:modelValue":_[2]||(_[2]=E=>r.value.maritime_port=E),placeholder:"\u56FD\u5185\u6E2F\u53E3"},null,8,["modelValue"])]),_:1}),e(w,null,{default:u(()=>[e(M,{size:"small",style:{"align-items":"center","margin-left":"30px"}},{default:u(()=>[e(N,{theme:"primary",onClick:B},{default:u(()=>[F("\u67E5\u8BE2")]),_:1}),e(N,{theme:"success",onClick:P},{default:u(()=>[F("\u65B0\u5EFA\u91C7\u8D2D")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),We,S("div",je,[e(X,{columns:o,data:a.value,loading:t.value,bordered:"",hover:"","row-key":"purchase_order_id",stripe:""},{sku_amount:u(({row:E})=>[F($(T(l).format(E.sku_amount/100)),1)]),pay_amount:u(({row:E})=>[F($(T(l).format(E.pay_amount/100)),1)]),pay_state:u(({row:E})=>[F($(E.pay_state===1?`\u5DF2\u652F\u4ED8: 
`+T(l).format(E.pay_amount/100):"\u5F85\u652F\u4ED8"),1)]),op:u(({row:E})=>[E.purchase_step!=="\u5B8C\u6210"?(V(),K(N,{key:0,size:"small",theme:"primary",variant:"text",onClick:le=>v(E)},{default:u(()=>[F($(T(j)(E.purchase_step)),1)]),_:2},1032,["onClick"])):I("v-if",!0),E.purchase_step!=="\u8349\u7A3F"?(V(),K(N,{key:1,size:"small",theme:"default",variant:"text",onClick:le=>h(E)},{default:u(()=>[F(" \u6253\u5370 ")]),_:2},1032,["onClick"])):I("v-if",!0),E.purchase_step!=="\u8349\u7A3F"&&E.pay_state===0?(V(),K(N,{key:2,size:"small",theme:"success",variant:"text",onClick:le=>f(E)},{default:u(()=>[F(" \u652F\u4ED8 ")]),_:2},1032,["onClick"])):I("v-if",!0)]),_:1},8,["data","loading"]),e(O,{modelValue:n.value,"onUpdate:modelValue":_[3]||(_[3]=E=>n.value=E),pageSize:m.value,"onUpdate:pageSize":_[4]||(_[4]=E=>m.value=E),"page-size-options":g,total:c.value,class:"pagination",onChange:C},null,8,["modelValue","pageSize","total"])])]),_:1}),e(ae,{ref_key:"selectPurchaseSkuDialog",ref:i,onOnOrderChange:_[5]||(_[5]=E=>B())},null,512),e(ne,{ref_key:"inputShippingDialog",ref:b,onOnOrderChange:_[6]||(_[6]=E=>B())},null,512),e(oe,{ref_key:"checkInWareHouseDialog",ref:d,onOnOrderChange:_[7]||(_[7]=E=>B())},null,512),e(re,{ref_key:"printPurchaseOrderDialog",ref:p},null,512),e(ie,{ref_key:"payDialog",ref:k,onOnOrderChange:_[8]||(_[8]=E=>B())},null,512)])}}});var Ze=R(Ge,[["__file","/Users/jkguo/workspace/ec-erp-static/src/pages/supply/purchaseOrderList.vue"]]);export{Ze as default};

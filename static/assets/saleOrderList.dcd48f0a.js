import{i as et,r as V,M as L,l as pt,_ as gt,d as $t,n as ht,k as mt,a as U,b as Z,c as kt,h as j,w as c,e as m,u as tt,g as N,f as X,t as W,j as nt,p as yt,q as Dt,o as Ot}from"./index.3f570dd2.js";import{s as xt}from"./warehouseApis.3f1e353b.js";import{a as bt,s as At,b as vt,l as Et}from"./skuUtil.c32bf851.js";import"./supplierApis.a443fc1c.js";const Ut=p=>et.post("/erp_api/sale/save_sku_sale_price",p),zt=p=>et.post("/erp_api/sale/search_sku_sale_price",p),Yt=p=>et.post("/erp_api/sale/create_sale_order",p),Tt=p=>et.post("/erp_api/sale/update_sale_order",p),Kt=p=>et.post("/erp_api/sale/delete_sale_order",p),Pt=p=>et.post("/erp_api/sale/submit_sale_order",p),It=p=>et.post("/erp_api/sale/search_sale_order",p),lt=V(new Map);async function Vt(){lt.value=new Map;const p=1e4;let B=1,l=!0;try{for(;l;){const $=await xt({current_page:B,page_size:p,search_sku:""});$.list&&$.list.length>0&&$.list.forEach(w=>{lt.value.set(w.sku,w)}),l=$.list&&$.list.length===p,B++}console.log(`\u6210\u529F\u52A0\u8F7D ${lt.value.size} \u6761SKU\u62E3\u8D27\u5907\u6CE8\u4FE1\u606F`)}catch(h){console.error("\u52A0\u8F7DSKU\u62E3\u8D27\u5907\u6CE8\u5931\u8D25:",h),await L.error(`\u52A0\u8F7DSKU\u62E3\u8D27\u5907\u6CE8\u5F02\u5E38: ${h}`)}}function _t(p,B){const l=lt.value.get(p);if(!l)return{picking_count:B,picking_unit:"pcs",display_text:`${B} pcs`};if(l.support_pkg_picking&&l.pkg_picking_unit>0){const $=Math.floor(B/l.pkg_picking_unit),w=B%l.pkg_picking_unit;if(w===0)return{picking_count:$,picking_unit:l.pkg_picking_unit_name,display_text:`${$} ${l.pkg_picking_unit_name}`};if($>0)return{picking_count:$,picking_unit:l.pkg_picking_unit_name,display_text:`${$} ${l.pkg_picking_unit_name} + ${w} ${l.picking_unit_name}`}}const h=B/l.picking_unit;return{picking_count:h,picking_unit:l.picking_unit_name,display_text:`${h} ${l.picking_unit_name}`}}function Nt(p){if(!p||p.length===0)return"-";const B=new Map;p.forEach(h=>{const $=h.sku_group||"\u672A\u5206\u7EC4",w=h.quantity||0,v=h.total_amount||(h.unit_price||0)*w;if(B.has($)){const x=B.get($);B.set($,{totalQuantity:x.totalQuantity+w,totalAmount:x.totalAmount+v,firstSku:x.firstSku})}else B.set($,{totalQuantity:w,totalAmount:v,firstSku:h.sku})});const l=[];return B.forEach((h,$)=>{const w=_t(h.firstSku,h.totalQuantity);l.push(`${$}: ${w.display_text} = ${h.totalAmount.toFixed(2)}`)}),l.join(`
`)}const at=V(new Map),dt=V(!1);let st=null;async function St(){return st||(dt.value?Promise.resolve():(st=(async()=>{at.value=new Map,dt.value=!1;const p=1e4;let B=1,l=!0;try{for(;l;){const $=await zt({current_page:B,page_size:p,sku:""}),w=$.list||$.records||[];w.length>0&&w.forEach(v=>{at.value.set(v.sku,v.unit_price)}),l=w.length===p,B++}console.log(`\u6210\u529F\u52A0\u8F7D ${at.value.size} \u6761SKU\u9500\u552E\u4EF7\u683C\u4FE1\u606F`),dt.value=!0}catch(h){console.error("\u52A0\u8F7DSKU\u9500\u552E\u4EF7\u683C\u5931\u8D25:",h),await L.error(`\u52A0\u8F7DSKU\u9500\u552E\u4EF7\u683C\u5F02\u5E38: ${h}`)}finally{st=null}})(),st))}function qt(p){return at.value.get(p)||0}async function Lt(p){const B=[];for(const l of p){const h=at.value.get(l.sku),$=l.unit_price;(h===void 0||h!==$)&&(B.push(Ut({sku:l.sku,unit_price:$})),at.value.set(l.sku,$))}B.length>0&&(await Promise.all(B),console.log(`\u6210\u529F\u66F4\u65B0 ${B.length} \u6761SKU\u9500\u552E\u4EF7\u683C`))}var Ft={exports:{}};(function(p,B){(function(l,h){p.exports=h()})(pt,function(){var l=1e3,h=6e4,$=36e5,w="millisecond",v="second",x="minute",k="hour",Y="day",z="week",g="month",E="quarter",b="year",C="date",r="Invalid Date",F=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,K=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,M={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(f){var e=["th","st","nd","rd"],t=f%100;return"["+f+(e[(t-20)%10]||e[t]||e[0])+"]"}},y=function(f,e,t){var _=String(f);return!_||_.length>=e?f:""+Array(e+1-_.length).join(t)+f},S={s:y,z:function(f){var e=-f.utcOffset(),t=Math.abs(e),_=Math.floor(t/60),n=t%60;return(e<=0?"+":"-")+y(_,2,"0")+":"+y(n,2,"0")},m:function f(e,t){if(e.date()<t.date())return-f(t,e);var _=12*(t.year()-e.year())+(t.month()-e.month()),n=e.clone().add(_,g),u=t-n<0,i=e.clone().add(_+(u?-1:1),g);return+(-(_+(t-n)/(u?n-i:i-n))||0)},a:function(f){return f<0?Math.ceil(f)||0:Math.floor(f)},p:function(f){return{M:g,y:b,w:z,d:Y,D:C,h:k,m:x,s:v,ms:w,Q:E}[f]||String(f||"").toLowerCase().replace(/s$/,"")},u:function(f){return f===void 0}},A="en",s={};s[A]=M;var a=function(f){return f instanceof P},d=function f(e,t,_){var n;if(!e)return A;if(typeof e=="string"){var u=e.toLowerCase();s[u]&&(n=u),t&&(s[u]=t,n=u);var i=e.split("-");if(!n&&i.length>1)return f(i[0])}else{var O=e.name;s[O]=e,n=O}return!_&&n&&(A=n),n||!_&&A},D=function(f,e){if(a(f))return f.clone();var t=typeof e=="object"?e:{};return t.date=f,t.args=arguments,new P(t)},o=S;o.l=d,o.i=a,o.w=function(f,e){return D(f,{locale:e.$L,utc:e.$u,x:e.$x,$offset:e.$offset})};var P=function(){function f(t){this.$L=d(t.locale,null,!0),this.parse(t)}var e=f.prototype;return e.parse=function(t){this.$d=function(_){var n=_.date,u=_.utc;if(n===null)return new Date(NaN);if(o.u(n))return new Date;if(n instanceof Date)return new Date(n);if(typeof n=="string"&&!/Z$/i.test(n)){var i=n.match(F);if(i){var O=i[2]-1||0,I=(i[7]||"0").substring(0,3);return u?new Date(Date.UTC(i[1],O,i[3]||1,i[4]||0,i[5]||0,i[6]||0,I)):new Date(i[1],O,i[3]||1,i[4]||0,i[5]||0,i[6]||0,I)}}return new Date(n)}(t),this.$x=t.x||{},this.init()},e.init=function(){var t=this.$d;this.$y=t.getFullYear(),this.$M=t.getMonth(),this.$D=t.getDate(),this.$W=t.getDay(),this.$H=t.getHours(),this.$m=t.getMinutes(),this.$s=t.getSeconds(),this.$ms=t.getMilliseconds()},e.$utils=function(){return o},e.isValid=function(){return this.$d.toString()!==r},e.isSame=function(t,_){var n=D(t);return this.startOf(_)<=n&&n<=this.endOf(_)},e.isAfter=function(t,_){return D(t)<this.startOf(_)},e.isBefore=function(t,_){return this.endOf(_)<D(t)},e.$g=function(t,_,n){return o.u(t)?this[_]:this.set(n,t)},e.unix=function(){return Math.floor(this.valueOf()/1e3)},e.valueOf=function(){return this.$d.getTime()},e.startOf=function(t,_){var n=this,u=!!o.u(_)||_,i=o.p(t),O=function(ut,H){var J=o.w(n.$u?Date.UTC(n.$y,H,ut):new Date(n.$y,H,ut),n);return u?J:J.endOf(Y)},I=function(ut,H){return o.w(n.toDate()[ut].apply(n.toDate("s"),(u?[0,0,0,0]:[23,59,59,999]).slice(H)),n)},T=this.$W,q=this.$M,Q=this.$D,G="set"+(this.$u?"UTC":"");switch(i){case b:return u?O(1,0):O(31,11);case g:return u?O(1,q):O(0,q+1);case z:var rt=this.$locale().weekStart||0,it=(T<rt?T+7:T)-rt;return O(u?Q-it:Q+(6-it),q);case Y:case C:return I(G+"Hours",0);case k:return I(G+"Minutes",1);case x:return I(G+"Seconds",2);case v:return I(G+"Milliseconds",3);default:return this.clone()}},e.endOf=function(t){return this.startOf(t,!1)},e.$set=function(t,_){var n,u=o.p(t),i="set"+(this.$u?"UTC":""),O=(n={},n[Y]=i+"Date",n[C]=i+"Date",n[g]=i+"Month",n[b]=i+"FullYear",n[k]=i+"Hours",n[x]=i+"Minutes",n[v]=i+"Seconds",n[w]=i+"Milliseconds",n)[u],I=u===Y?this.$D+(_-this.$W):_;if(u===g||u===b){var T=this.clone().set(C,1);T.$d[O](I),T.init(),this.$d=T.set(C,Math.min(this.$D,T.daysInMonth())).$d}else O&&this.$d[O](I);return this.init(),this},e.set=function(t,_){return this.clone().$set(t,_)},e.get=function(t){return this[o.p(t)]()},e.add=function(t,_){var n,u=this;t=Number(t);var i=o.p(_),O=function(q){var Q=D(u);return o.w(Q.date(Q.date()+Math.round(q*t)),u)};if(i===g)return this.set(g,this.$M+t);if(i===b)return this.set(b,this.$y+t);if(i===Y)return O(1);if(i===z)return O(7);var I=(n={},n[x]=h,n[k]=$,n[v]=l,n)[i]||1,T=this.$d.getTime()+t*I;return o.w(T,this)},e.subtract=function(t,_){return this.add(-1*t,_)},e.format=function(t){var _=this,n=this.$locale();if(!this.isValid())return n.invalidDate||r;var u=t||"YYYY-MM-DDTHH:mm:ssZ",i=o.z(this),O=this.$H,I=this.$m,T=this.$M,q=n.weekdays,Q=n.months,G=function(H,J,ct,ot){return H&&(H[J]||H(_,u))||ct[J].slice(0,ot)},rt=function(H){return o.s(O%12||12,H,"0")},it=n.meridiem||function(H,J,ct){var ot=H<12?"AM":"PM";return ct?ot.toLowerCase():ot},ut={YY:String(this.$y).slice(-2),YYYY:this.$y,M:T+1,MM:o.s(T+1,2,"0"),MMM:G(n.monthsShort,T,Q,3),MMMM:G(Q,T),D:this.$D,DD:o.s(this.$D,2,"0"),d:String(this.$W),dd:G(n.weekdaysMin,this.$W,q,2),ddd:G(n.weekdaysShort,this.$W,q,3),dddd:q[this.$W],H:String(O),HH:o.s(O,2,"0"),h:rt(1),hh:rt(2),a:it(O,I,!0),A:it(O,I,!1),m:String(I),mm:o.s(I,2,"0"),s:String(this.$s),ss:o.s(this.$s,2,"0"),SSS:o.s(this.$ms,3,"0"),Z:i};return u.replace(K,function(H,J){return J||ut[H]||i.replace(":","")})},e.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},e.diff=function(t,_,n){var u,i=o.p(_),O=D(t),I=(O.utcOffset()-this.utcOffset())*h,T=this-O,q=o.m(this,O);return q=(u={},u[b]=q/12,u[g]=q,u[E]=q/3,u[z]=(T-I)/6048e5,u[Y]=(T-I)/864e5,u[k]=T/$,u[x]=T/h,u[v]=T/l,u)[i]||T,n?q:o.a(q)},e.daysInMonth=function(){return this.endOf(g).$D},e.$locale=function(){return s[this.$L]},e.locale=function(t,_){if(!t)return this.$L;var n=this.clone(),u=d(t,_,!0);return u&&(n.$L=u),n},e.clone=function(){return o.w(this.$d,this)},e.toDate=function(){return new Date(this.valueOf())},e.toJSON=function(){return this.isValid()?this.toISOString():null},e.toISOString=function(){return this.$d.toISOString()},e.toString=function(){return this.$d.toUTCString()},f}(),R=P.prototype;return D.prototype=R,[["$ms",w],["$s",v],["$m",x],["$H",k],["$W",Y],["$M",g],["$y",b],["$D",C]].forEach(function(f){R[f[1]]=function(e){return this.$g(e,f[0],f[1])}}),D.extend=function(f,e){return f.$i||(f(e,P,D),f.$i=!0),D},D.locale=d,D.isDayjs=a,D.unix=function(f){return D(1e3*f)},D.en=s[A],D.Ls=s,D.p={},D})})(Ft);var ft=Ft.exports,wt={exports:{}};(function(p,B){(function(l,h){p.exports=h()})(pt,function(){var l="minute",h=/[+-]\d\d(?::?\d\d)?/g,$=/([+-]|\d\d)/g;return function(w,v,x){var k=v.prototype;x.utc=function(r){var F={date:r,utc:!0,args:arguments};return new v(F)},k.utc=function(r){var F=x(this.toDate(),{locale:this.$L,utc:!0});return r?F.add(this.utcOffset(),l):F},k.local=function(){return x(this.toDate(),{locale:this.$L,utc:!1})};var Y=k.parse;k.parse=function(r){r.utc&&(this.$u=!0),this.$utils().u(r.$offset)||(this.$offset=r.$offset),Y.call(this,r)};var z=k.init;k.init=function(){if(this.$u){var r=this.$d;this.$y=r.getUTCFullYear(),this.$M=r.getUTCMonth(),this.$D=r.getUTCDate(),this.$W=r.getUTCDay(),this.$H=r.getUTCHours(),this.$m=r.getUTCMinutes(),this.$s=r.getUTCSeconds(),this.$ms=r.getUTCMilliseconds()}else z.call(this)};var g=k.utcOffset;k.utcOffset=function(r,F){var K=this.$utils().u;if(K(r))return this.$u?0:K(this.$offset)?g.call(this):this.$offset;if(typeof r=="string"&&(r=function(A){A===void 0&&(A="");var s=A.match(h);if(!s)return null;var a=(""+s[0]).match($)||["-",0,0],d=a[0],D=60*+a[1]+ +a[2];return D===0?0:d==="+"?D:-D}(r),r===null))return this;var M=Math.abs(r)<=16?60*r:r,y=this;if(F)return y.$offset=M,y.$u=r===0,y;if(r!==0){var S=this.$u?this.toDate().getTimezoneOffset():-1*this.utcOffset();(y=this.local().add(M+S,l)).$offset=M,y.$x.$localOffset=S}else y=this.utc();return y};var E=k.format;k.format=function(r){var F=r||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":"");return E.call(this,F)},k.valueOf=function(){var r=this.$utils().u(this.$offset)?0:this.$offset+(this.$x.$localOffset||this.$d.getTimezoneOffset());return this.$d.valueOf()-6e4*r},k.isUTC=function(){return!!this.$u},k.toISOString=function(){return this.toDate().toISOString()},k.toString=function(){return this.toDate().toUTCString()};var b=k.toDate;k.toDate=function(r){return r==="s"&&this.$offset?x(this.format("YYYY-MM-DD HH:mm:ss:SSS")).toDate():b.call(this)};var C=k.diff;k.diff=function(r,F,K){if(r&&this.$u===r.$u)return C.call(this,r,F,K);var M=this.local(),y=x(r).local();return C.call(M,y,F,K)}}})})(wt);var Ht=wt.exports,Ct={exports:{}};(function(p,B){(function(l,h){p.exports=h()})(pt,function(){var l={year:0,month:1,day:2,hour:3,minute:4,second:5},h={};return function($,w,v){var x,k=function(E,b,C){C===void 0&&(C={});var r=new Date(E),F=function(K,M){M===void 0&&(M={});var y=M.timeZoneName||"short",S=K+"|"+y,A=h[S];return A||(A=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:K,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZoneName:y}),h[S]=A),A}(b,C);return F.formatToParts(r)},Y=function(E,b){for(var C=k(E,b),r=[],F=0;F<C.length;F+=1){var K=C[F],M=K.type,y=K.value,S=l[M];S>=0&&(r[S]=parseInt(y,10))}var A=r[3],s=A===24?0:A,a=r[0]+"-"+r[1]+"-"+r[2]+" "+s+":"+r[4]+":"+r[5]+":000",d=+E;return(v.utc(a).valueOf()-(d-=d%1e3))/6e4},z=w.prototype;z.tz=function(E,b){E===void 0&&(E=x);var C=this.utcOffset(),r=this.toDate(),F=r.toLocaleString("en-US",{timeZone:E}),K=Math.round((r-new Date(F))/1e3/60),M=v(F).$set("millisecond",this.$ms).utcOffset(15*-Math.round(r.getTimezoneOffset()/15)-K,!0);if(b){var y=M.utcOffset();M=M.add(C-y,"minute")}return M.$x.$timezone=E,M},z.offsetName=function(E){var b=this.$x.$timezone||v.tz.guess(),C=k(this.valueOf(),b,{timeZoneName:E}).find(function(r){return r.type.toLowerCase()==="timezonename"});return C&&C.value};var g=z.startOf;z.startOf=function(E,b){if(!this.$x||!this.$x.$timezone)return g.call(this,E,b);var C=v(this.format("YYYY-MM-DD HH:mm:ss:SSS"));return g.call(C,E,b).tz(this.$x.$timezone,!0)},v.tz=function(E,b,C){var r=C&&b,F=C||b||x,K=Y(+v(),F);if(typeof E!="string")return v(E).tz(F);var M=function(s,a,d){var D=s-60*a*1e3,o=Y(D,d);if(a===o)return[D,a];var P=Y(D-=60*(o-a)*1e3,d);return o===P?[D,o]:[s-60*Math.min(o,P)*1e3,Math.max(o,P)]}(v.utc(E,r).valueOf(),K,F),y=M[0],S=M[1],A=v(y).utcOffset(S);return A.$x.$timezone=F,A},v.tz.guess=function(){return Intl.DateTimeFormat().resolvedOptions().timeZone},v.tz.setDefault=function(E){x=E}}})})(Ct);var Zt=Ct.exports;const Mt=p=>(yt("data-v-ec2d381a"),p=p(),Dt(),p),jt={style:{"text-align":"right"}},Wt={style:{"text-align":"right"}},Rt=Mt(()=>X("br",null,null,-1)),Gt={class:"table-container"},Qt=Mt(()=>X("br",null,null,-1)),Jt={name:"EditSaleOrderDialog"},Xt=$t({...Jt,emits:["onOrderChange"],setup(p,{expose:B,emit:l}){ft.extend(Ht),ft.extend(Zt);const h=new Intl.NumberFormat("zh-CN",{style:"currency",currency:"CNY"}),$=V(!1),w=V(!0),v=V(!1),x=V(null),k=V(""),Y=V(""),z=V(""),g=V([]),E=V(0),b=ht(()=>{if(!Y.value)return[];const s=bt.value.get(Y.value);return s?s.map(a=>({label:`${a.sku} - ${a.sku_name}`,value:a.sku})):[]}),C=ht(()=>{const s=[{width:100,colKey:"sku_group",title:"SKU\u5206\u7EC4",align:"center"},{width:120,colKey:"sku_name",title:"\u5546\u54C1\u540D",align:"center"},{width:150,colKey:"sku",title:"\u5546\u54C1SKU",align:"center"},{width:100,colKey:"quantity",title:"\u6570\u91CF",align:"center",edit:v.value?void 0:{component:mt,props:{autofocus:!0,min:1},validateTrigger:"change",abortEditOnEvent:["onEnter","onBlur"],onEdited:a=>{g.value.splice(a.rowIndex,1,a.newRowData),r(a.rowIndex),M()},rules:[{required:!0,message:"\u4E0D\u80FD\u4E3A\u7A7A"}],defaultEditable:!0}},{width:150,colKey:"picking_info",title:"\u62E3\u8D27\u4FE1\u606F",align:"center"},{width:100,colKey:"unit_price",title:"\u5355\u4EF7",align:"center",edit:v.value?void 0:{component:mt,props:{autofocus:!0,min:.01,step:.01},validateTrigger:"change",abortEditOnEvent:["onEnter","onBlur"],onEdited:a=>{g.value.splice(a.rowIndex,1,a.newRowData),M()},rules:[{required:!0,message:"\u4E0D\u80FD\u4E3A\u7A7A"}],defaultEditable:!1}},{width:120,colKey:"total_amount",title:"\u603B\u4EF7",align:"center"}];return v.value||s.push({width:80,colKey:"operation",title:"\u64CD\u4F5C",align:"center"}),s}),r=s=>{const a=g.value[s],d=_t(a.sku,a.quantity);a.picking_display_text=d.display_text,a.total_amount=a.unit_price*a.quantity},F=()=>{if(!z.value){L.warning("\u8BF7\u5148\u9009\u62E9SKU");return}if(g.value.find(o=>o.sku===z.value)){L.warning("\u8BE5SKU\u5DF2\u6DFB\u52A0");return}const a=vt.value.get(z.value);if(!a){L.error("SKU\u4FE1\u606F\u4E0D\u5B58\u5728");return}const d=qt(z.value),D={idx:g.value.length+1,sku:a.sku,sku_group:a.sku_group,sku_name:a.sku_name,erp_sku_image_url:a.erp_sku_image_url,quantity:1,unit_price:d||0,total_amount:d||0,picking_display_text:""};g.value.push(D),r(g.value.length-1),M(),z.value=""},K=s=>{const a=g.value.findIndex(d=>d.idx===s.idx);a!==-1&&(g.value.splice(a,1),g.value.forEach((d,D)=>{d.idx=D+1}),M())},M=()=>{E.value=0,g.value.forEach(s=>{s.total_amount=s.quantity*s.unit_price,E.value+=s.total_amount})},y=async(s,a=!1)=>{v.value=a,await Et(),await St(),s?(w.value=!1,x.value=s,k.value=s.order_date,g.value=[],s.sale_sku_list.forEach((d,D)=>{const o=vt.value.get(d.sku),P=_t(d.sku,d.quantity);g.value.push({idx:D+1,sku:d.sku,sku_group:d.sku_group||(o==null?void 0:o.sku_group)||"",sku_name:d.sku_name||(o==null?void 0:o.sku_name)||"",erp_sku_image_url:d.erp_sku_image_url||(o==null?void 0:o.erp_sku_image_url)||"",quantity:d.quantity,unit_price:d.unit_price,total_amount:d.total_amount||d.unit_price*d.quantity,picking_display_text:P.display_text})})):(w.value=!0,x.value=null,k.value=ft().tz("Asia/Shanghai").format("YYYY-MM-DD"),g.value=[]),Y.value="",z.value="",M(),$.value=!0},S=()=>g.value.map(s=>({sku:s.sku,sku_group:s.sku_group,sku_name:s.sku_name,erp_sku_image_url:s.erp_sku_image_url,quantity:s.quantity,unit_price:s.unit_price,total_amount:s.total_amount})),A=async()=>{if(!k.value){L.error("\u8BF7\u9009\u62E9\u8BA2\u5355\u65E5\u671F");return}if(g.value.length===0){L.error("\u8BF7\u81F3\u5C11\u6DFB\u52A0\u4E00\u4E2A\u5546\u54C1");return}if(g.value.filter(a=>!a.unit_price||a.unit_price<=0).length>0){L.error("\u5B58\u5728\u672A\u8BBE\u7F6E\u5355\u4EF7\u7684\u5546\u54C1\uFF0C\u8BF7\u68C0\u67E5");return}try{await Lt(g.value);const a=S();if(w.value){const d={order_date:k.value,sale_sku_list:a};console.log("\u521B\u5EFA\u9500\u552E\u8BA2\u5355:",d),await Yt(d),L.success("\u521B\u5EFA\u9500\u552E\u8BA2\u5355\u6210\u529F")}else{const d={order_id:x.value.order_id,order_date:k.value,sale_sku_list:a};console.log("\u66F4\u65B0\u9500\u552E\u8BA2\u5355:",d),await Tt(d),L.success("\u66F4\u65B0\u9500\u552E\u8BA2\u5355\u6210\u529F")}$.value=!1,l("onOrderChange")}catch(a){console.error("\u4FDD\u5B58\u9500\u552E\u8BA2\u5355\u5931\u8D25:",a),L.error(`\u4FDD\u5B58\u9500\u552E\u8BA2\u5355\u5F02\u5E38: ${a}`)}};return B({popupDialog:y}),(s,a)=>{const d=U("t-date-picker"),D=U("t-form-item"),o=U("t-form"),P=U("t-col"),R=U("t-row"),f=U("t-select"),e=U("t-button"),t=U("t-image"),_=U("t-space"),n=U("t-table"),u=U("t-dialog");return Z(),kt("div",null,[$.value?(Z(),j(u,{key:0,visible:$.value,"onUpdate:visible":a[4]||(a[4]=i=>$.value=i),"cancel-btn":null,"close-on-esc-keydown":!1,"close-on-overlay-click":!1,"confirm-btn":null,header:v.value?"\u67E5\u770B\u9500\u552E\u8BA2\u5355":w.value?"\u65B0\u5EFA\u9500\u552E\u8BA2\u5355":"\u7F16\u8F91\u9500\u552E\u8BA2\u5355","show-overlay":"",width:"85%"},{default:c(()=>[m(R,null,{default:c(()=>[m(P,{span:10},{default:c(()=>[m(o,{layout:"inline"},{default:c(()=>[m(D,{label:"\u8BA2\u5355\u65E5\u671F:",name:"orderDate",required:""},{default:c(()=>[m(d,{modelValue:k.value,"onUpdate:modelValue":a[0]||(a[0]=i=>k.value=i),disabled:v.value,"allow-input":"",clearable:"",format:"YYYY-MM-DD",placeholder:"\u9009\u62E9\u8BA2\u5355\u65E5\u671F",style:{width:"200px"}},null,8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1})]),_:1}),v.value?(Z(),j(R,{key:1},{default:c(()=>[m(P,{span:12}),m(P,{span:12},{default:c(()=>[X("h3",Wt,"\u603B\u91D1\u989D\uFF1A"+W(tt(h).format(E.value)),1)]),_:1})]),_:1})):(Z(),j(R,{key:0},{default:c(()=>[m(P,{span:8},{default:c(()=>[m(o,{layout:"inline"},{default:c(()=>[m(D,{label:"SKU\u5206\u7EC4:",name:"skuGroupName"},{default:c(()=>[m(f,{modelValue:Y.value,"onUpdate:modelValue":a[1]||(a[1]=i=>Y.value=i),options:tt(At),filterable:"",placeholder:"-\u8BF7\u9009\u62E9SKU\u5206\u7EC4-",style:{width:"200px"}},null,8,["modelValue","options"])]),_:1}),m(D,{label:"SKU:",name:"selectedSku"},{default:c(()=>[m(f,{modelValue:z.value,"onUpdate:modelValue":a[2]||(a[2]=i=>z.value=i),options:tt(b),filterable:"",placeholder:"-\u8BF7\u9009\u62E9SKU-",style:{width:"250px"}},null,8,["modelValue","options"])]),_:1})]),_:1})]),_:1}),m(P,{span:3},{default:c(()=>[m(e,{theme:"default",onClick:F},{default:c(()=>[N("\u6DFB\u52A0SKU")]),_:1})]),_:1}),m(P,{span:7},{default:c(()=>[X("h3",jt,"\u603B\u91D1\u989D\uFF1A"+W(tt(h).format(E.value)),1)]),_:1})]),_:1})),Rt,X("div",Gt,[m(n,{bordered:!0,columns:tt(C),data:g.value,"lazy-load":"",resizable:"","row-key":"idx","table-layout":"fixed"},{sku:c(({row:i})=>[m(_,null,{default:c(()=>[m(t,{src:i.erp_sku_image_url,style:{width:"30px",height:"30px"}},null,8,["src"]),N(" "+W(i.sku),1)]),_:2},1024)]),picking_info:c(({row:i})=>[N(W(i.picking_display_text),1)]),total_amount:c(({row:i})=>[N(W(tt(h).format(i.total_amount)),1)]),operation:c(({row:i})=>[v.value?nt("v-if",!0):(Z(),j(e,{key:0,size:"small",theme:"danger",variant:"text",onClick:O=>K(i)},{default:c(()=>[N(" \u5220\u9664 ")]),_:2},1032,["onClick"]))]),_:1},8,["columns","data"]),Qt,m(R,null,{default:c(()=>[m(P,{span:9}),m(P,{span:3},{default:c(()=>[m(_,null,{default:c(()=>[m(e,{style:{float:"right"},theme:"default",onClick:a[3]||(a[3]=i=>$.value=!1)},{default:c(()=>[N(W(v.value?"\u5173\u95ED":"\u53D6\u6D88"),1)]),_:1}),v.value?nt("v-if",!0):(Z(),j(e,{key:0,style:{float:"right"},theme:"primary",onClick:A},{default:c(()=>[N(" \u4FDD\u5B58 ")]),_:1}))]),_:1})]),_:1})]),_:1})])]),_:1},8,["visible","header"])):nt("v-if",!0)])}}});var Bt=gt(Xt,[["__scopeId","data-v-ec2d381a"],["__file","/Users/jkguo/workspace/ec-erp-static/src/pages/sales/components/editSaleOrderDialog.vue"]]);const te=p=>(yt("data-v-135960ee"),p=p(),Dt(),p),ee=te(()=>X("br",null,null,-1)),ue={class:"table-container"},ne={style:{"white-space":"pre-wrap"}},ae={name:"SaleOrderList",components:{EditSaleOrderDialog:Bt}},re=$t({...ae,setup(p){const B=new Intl.NumberFormat("zh-CN",{style:"currency",currency:"CNY"}),l=V({status:"",begin_date:"",end_date:""}),h=[{label:"\u5F85\u540C\u6B65",value:"\u5F85\u540C\u6B65"},{label:"\u5DF2\u540C\u6B65",value:"\u5DF2\u540C\u6B65"}],$=[{width:80,colKey:"order_id",title:"\u8BA2\u5355ID",align:"center"},{width:150,colKey:"order_date",title:"\u8BA2\u5355\u65E5\u671F",align:"center"},{width:250,colKey:"sku_order_summary",title:"\u8BA2\u5355\u6458\u8981",align:"left"},{width:120,colKey:"total_amount",title:"\u603B\u91D1\u989D",align:"center"},{width:100,colKey:"status",title:"\u72B6\u6001",align:"center"},{width:150,colKey:"modify_time",title:"\u4FEE\u6539\u65F6\u95F4",align:"center"},{width:180,colKey:"op",title:"\u64CD\u4F5C",align:"center",fixed:"right"}],w=V([]),v=V(!1),x=V(1),k=V(20),Y=[10,20,50,100],z=V(0),g=V(),E=async()=>{v.value=!0;try{const y={status:l.value.status||void 0,begin_date:l.value.begin_date||void 0,end_date:l.value.end_date||void 0,current_page:x.value,page_size:k.value},S=await It(y),A=S.list||S.records||[];w.value=A.map(s=>({...s,sku_order_summary:Nt(s.sale_sku_list)})),z.value=S.total||0}catch(y){console.error("\u67E5\u8BE2\u9500\u552E\u8BA2\u5355\u5931\u8D25:",y),L.error(`\u67E5\u8BE2\u9500\u552E\u8BA2\u5355\u5F02\u5E38: ${y}`)}finally{v.value=!1}},b=()=>{E()},C=()=>{g.value.popupDialog(null,!1)},r=y=>{g.value.popupDialog(y,!1)},F=y=>{g.value.popupDialog(y,!0)},K=async y=>{try{await Pt({order_id:y.order_id}),L.success("\u63D0\u4EA4\u8BA2\u5355\u6210\u529F"),await E()}catch(S){console.error("\u63D0\u4EA4\u8BA2\u5355\u5931\u8D25:",S),L.error(`\u63D0\u4EA4\u8BA2\u5355\u5F02\u5E38: ${S}`)}},M=async y=>{try{await Kt({order_id:y.order_id}),L.success("\u5220\u9664\u8BA2\u5355\u6210\u529F"),await E()}catch(S){console.error("\u5220\u9664\u8BA2\u5355\u5931\u8D25:",S),L.error(`\u5220\u9664\u8BA2\u5355\u5F02\u5E38: ${S}`)}};return Ot(async()=>{Promise.all([Et(),St(),Vt()]).catch(y=>{console.error("\u9884\u52A0\u8F7D\u57FA\u7840\u6570\u636E\u5931\u8D25:",y)}),await E()}),(y,S)=>{const A=U("t-select"),s=U("t-form-item"),a=U("t-date-picker"),d=U("t-button"),D=U("t-space"),o=U("t-form"),P=U("t-col"),R=U("t-row"),f=U("t-tag"),e=U("t-popconfirm"),t=U("t-table"),_=U("t-pagination"),n=U("t-card");return Z(),kt("div",null,[m(n,null,{default:c(()=>[m(R,null,{default:c(()=>[m(P,{span:12},{default:c(()=>[m(o,{layout:"inline"},{default:c(()=>[m(s,{label:"\u8BA2\u5355\u72B6\u6001:",name:"status"},{default:c(()=>[m(A,{modelValue:l.value.status,"onUpdate:modelValue":S[0]||(S[0]=u=>l.value.status=u),options:h,clearable:"",placeholder:"\u8BF7\u9009\u62E9\u72B6\u6001",style:{width:"150px"}},null,8,["modelValue"])]),_:1}),m(s,{label:"\u5F00\u59CB\u65E5\u671F:",name:"begin_date"},{default:c(()=>[m(a,{modelValue:l.value.begin_date,"onUpdate:modelValue":S[1]||(S[1]=u=>l.value.begin_date=u),"allow-input":"",clearable:"",format:"YYYY-MM-DD",placeholder:"\u5F00\u59CB\u65E5\u671F",style:{width:"150px"}},null,8,["modelValue"])]),_:1}),m(s,{label:"\u7ED3\u675F\u65E5\u671F:",name:"end_date"},{default:c(()=>[m(a,{modelValue:l.value.end_date,"onUpdate:modelValue":S[2]||(S[2]=u=>l.value.end_date=u),"allow-input":"",clearable:"",format:"YYYY-MM-DD",placeholder:"\u7ED3\u675F\u65E5\u671F",style:{width:"150px"}},null,8,["modelValue"])]),_:1}),m(s,null,{default:c(()=>[m(D,{size:"small",style:{"align-items":"center","margin-left":"30px"}},{default:c(()=>[m(d,{theme:"primary",onClick:E},{default:c(()=>[N("\u67E5\u8BE2")]),_:1}),m(d,{theme:"success",onClick:C},{default:c(()=>[N("\u65B0\u5EFA\u8BA2\u5355")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),ee,X("div",ue,[m(t,{columns:$,data:w.value,loading:v.value,bordered:"",hover:"","row-key":"order_id",stripe:""},{sku_order_summary:c(({row:u})=>[X("div",ne,W(u.sku_order_summary),1)]),total_amount:c(({row:u})=>[N(W(tt(B).format(u.total_amount)),1)]),status:c(({row:u})=>[u.status==="\u5F85\u540C\u6B65"?(Z(),j(f,{key:0,theme:"warning"},{default:c(()=>[N(W(u.status),1)]),_:2},1024)):u.status==="\u5DF2\u540C\u6B65"?(Z(),j(f,{key:1,theme:"success"},{default:c(()=>[N(W(u.status),1)]),_:2},1024)):(Z(),j(f,{key:2},{default:c(()=>[N(W(u.status),1)]),_:2},1024))]),op:c(({row:u})=>[u.status==="\u5F85\u540C\u6B65"?(Z(),j(d,{key:0,size:"small",theme:"primary",variant:"text",onClick:i=>r(u)},{default:c(()=>[N(" \u7F16\u8F91 ")]),_:2},1032,["onClick"])):nt("v-if",!0),u.status==="\u5DF2\u540C\u6B65"?(Z(),j(d,{key:1,size:"small",theme:"primary",variant:"text",onClick:i=>F(u)},{default:c(()=>[N(" \u67E5\u770B ")]),_:2},1032,["onClick"])):nt("v-if",!0),u.status==="\u5F85\u540C\u6B65"?(Z(),j(e,{key:2,content:"\u786E\u8BA4\u63D0\u4EA4\u8BE5\u8BA2\u5355\u5417\uFF1F\u63D0\u4EA4\u540E\uFF0C\u4F1A\u5C06\u76F8\u5E94\u7684\u5E93\u5B58\u4ECEerp\u4E2D\u6263\u9664\u3002",theme:"success",onConfirm:i=>K(u)},{default:c(()=>[m(d,{size:"small",theme:"success",variant:"text"},{default:c(()=>[N("\u540C\u6B65erp")]),_:1})]),_:2},1032,["onConfirm"])):nt("v-if",!0),m(e,{content:"\u786E\u8BA4\u5220\u9664\u8BE5\u8BA2\u5355\u5417\uFF1F\u5220\u9664\u540E\u4E0D\u53EF\u6062\u590D",theme:"danger",onConfirm:i=>M(u)},{default:c(()=>[m(d,{size:"small",theme:"danger",variant:"text"},{default:c(()=>[N("\u5220\u9664")]),_:1})]),_:2},1032,["onConfirm"])]),_:1},8,["data","loading"]),m(_,{modelValue:x.value,"onUpdate:modelValue":S[3]||(S[3]=u=>x.value=u),pageSize:k.value,"onUpdate:pageSize":S[4]||(S[4]=u=>k.value=u),"page-size-options":Y,total:z.value,class:"pagination",onChange:b},null,8,["modelValue","pageSize","total"])])]),_:1}),m(Bt,{ref_key:"editSaleOrderDialog",ref:g,onOnOrderChange:S[5]||(S[5]=u=>E())},null,512)])}}});var ce=gt(re,[["__scopeId","data-v-135960ee"],["__file","/Users/jkguo/workspace/ec-erp-static/src/pages/sales/saleOrderList.vue"]]);export{ce as default};

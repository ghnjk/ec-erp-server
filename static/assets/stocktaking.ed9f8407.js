import{_ as L,d as M,r as d,o as O,p as P,q as j,M as C,a as _,b as v,c as E,f as p,g as s,t as i,e,w as t,h as q,u as I,j as Q,F as R,n as W}from"./index.c4cce00e.js";import{l as H,s as J}from"./skuUtil.116c281e.js";import{a as K}from"./supplierApis.920c8933.js";const X={class:"page-header"},Y={style:{float:"right","font-size":"medium"}},Z={class:"page-panel"},ee={style:{"margin-left":"15px","font-size":"medium"}},ue={name:"Stocktaking"},te=M({...ue,setup(ae){const b=d("\u672A\u767B\u5F55"),k=d(""),m=d([]),g=d(!1),c=d("skuGroup"),n=d({visible:!1,title:"\u8D27\u7269\u76D8\u70B9",sku:{sku:"",real_stock_sku:0,shipping_stock_quantity:0,taking_unit:"",taking_unit_sku_count:0,inventory:0}});O(async()=>{const{query:l}=P(),{token:a}=l;try{const r=await j(a);b.value=r.userName,await H()}catch(r){console.error(r),await C.error(`\u767B\u9646\u5F02\u5E38: ${r}`)}});const V=()=>{const l={sku_group:k.value,sku_name:"",sku:"",inventory_support_days:"",current_page:1,page_size:1e3,sort:{sortBy:"avg_sell_quantity",descending:!0}};f(l)},w=l=>{n.value.title=`\u8D27\u7269\u76D8\u70B9\uFF1A${l.sku_name}`,l.taking_unit=l.sku_unit_name,l.taking_unit_sku_count=l.sku_unit_quantity,l.real_stock_sku=Math.floor(l.inventory/l.taking_unit_sku_count),n.value.sku=l,n.value.visible=!0},x=()=>{m.value=[],c.value==="skuGroup"?k.value="":c.value==="lackStock"?f({sku_group:"",sku_name:"",sku:"",inventory_support_days:"14",current_page:1,page_size:30,sort:{sortBy:"avg_sell_quantity",descending:!0}}):c.value==="saleQuantity"&&f({sku_group:"",sku_name:"",sku:"",inventory_support_days:"",current_page:1,page_size:30,sort:{sortBy:"avg_sell_quantity",descending:!0}})},f=async l=>{g.value=!0;try{const a=await K(l);m.value=a.list,console.log("skuList",m.value)}catch(a){console.error(a),await C.error(`\u67E5\u8BE2sku\u5F02\u5E38: ${a}`)}g.value=!1};return(l,a)=>{const r=_("t-radio-button"),S=_("t-radio-group"),D=_("t-space"),G=_("t-select"),o=_("t-form-item"),y=_("t-form"),B=_("t-card"),z=_("t-image"),F=_("t-col"),T=_("t-link"),N=_("t-row"),U=_("t-loading"),h=_("t-input-number"),A=_("t-input"),$=_("t-drawer");return v(),E("div",null,[p("div",X,[p("h1",null,[s(" \u4ED3\u5E93\u76D8\u70B9 "),p("span",Y,"\u7528\u6237: "+i(b.value),1)])]),e(B,null,{default:t(()=>[e(y,null,{default:t(()=>[e(D,{direction:"vertical"},{default:t(()=>[e(S,{modelValue:c.value,"onUpdate:modelValue":a[0]||(a[0]=u=>c.value=u),"default-value":"skuGroup",style:{"margin-bottom":"20px"},onChange:x},{default:t(()=>[e(r,{value:"skuGroup"},{default:t(()=>[s("sku\u5206\u7EC4")]),_:1}),e(r,{value:"saleQuantity"},{default:t(()=>[s("\u9500\u91CFTOP30")]),_:1}),e(r,{value:"lackStock"},{default:t(()=>[s("\u8D27\u7269\u7D27\u7F3ATOP30")]),_:1})]),_:1},8,["modelValue"])]),_:1}),c.value==="skuGroup"?(v(),q(o,{key:0,label:"sku\u5206\u7EC4:",name:"skuGroup"},{default:t(()=>[e(G,{modelValue:k.value,"onUpdate:modelValue":a[1]||(a[1]=u=>k.value=u),options:I(J),clearable:"",filterable:"",placeholder:"-\u8BF7\u9009\u62E9\u5546\u54C1\u5206\u7EC4-",size:"large",onChange:V},null,8,["modelValue","options"])]),_:1})):Q("v-if",!0)]),_:1})]),_:1}),p("div",Z,[e(U,{loading:g.value},{default:t(()=>[e(D,{class:"sku-card",direction:"vertical",size:"large"},{default:t(()=>[(v(!0),E(R,null,W(m.value,u=>(v(),q(B,{key:u.sku,class:"sku-card"},{default:t(()=>[e(N,null,{default:t(()=>[e(F,{span:2},{default:t(()=>[e(z,{src:u.erp_sku_image_url,style:{width:"60px",height:"60px"}},null,8,["src"])]),_:2},1024),e(F,{span:10},{default:t(()=>[p("div",null,[e(y,null,{default:t(()=>[e(o,{label:"\u5546\u54C1\u540D",name:"sku_name"},{default:t(()=>[s(i(u.sku_name),1)]),_:2},1024),e(o,{label:"sku",name:"sku"},{default:t(()=>[s(i(u.sku),1)]),_:2},1024),e(o,{label:"\u91C7\u8D2D\u5355\u4F4D",name:"sku_unit_name"},{default:t(()=>[s(i(u.sku_unit_name)+" [\u5355\u4F4Dsku\u6570 "+i(u.sku_unit_quantity)+"] ",1)]),_:2},1024),e(o,{label:"\u65E5\u5747\u9500\u552E\u91CF",name:"avg_sell_quantity"},{default:t(()=>[s(i(u.avg_sell_quantity.toFixed(2)),1)]),_:2},1024),e(o,{label:"erp-\u5E93\u5B58",name:"inventory"},{default:t(()=>[s(i(u.inventory),1)]),_:2},1024),e(o,{label:"\u5E93\u5B58\u652F\u6491\u5929\u6570",name:"inventory_support_days"},{default:t(()=>[s(i(u.inventory_support_days),1)]),_:2},1024),e(o,{label:"\u6D77\u8FD0\u4E2Dsku",name:"shipping_stock_quantity"},{default:t(()=>[s(i(u.shipping_stock_quantity),1)]),_:2},1024),e(o,{label:"\u64CD\u4F5C",name:"action"},{default:t(()=>[e(T,{hover:"color",style:{"margin-left":"16px"},theme:"primary",onClick:ne=>w(u)},{default:t(()=>[s(" \u76D8\u70B9 ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1},8,["loading"])]),e($,{visible:n.value.visible,"onUpdate:visible":a[5]||(a[5]=u=>n.value.visible=u),header:n.value.title,"on-overlay-click":()=>n.value.visible=!1,placement:"bottom",size:"70%",onCancel:a[6]||(a[6]=u=>n.value.visible=!1)},{default:t(()=>[e(y,null,{default:t(()=>[e(o,{label:"sku",name:"sku"},{default:t(()=>[s(i(n.value.sku.sku),1)]),_:1}),e(o,{label:"\u5B9E\u9645\u5E93\u5B58",name:"real_quantity"},{default:t(()=>[e(h,{modelValue:n.value.sku.real_stock_sku,"onUpdate:modelValue":a[2]||(a[2]=u=>n.value.sku.real_stock_sku=u)},null,8,["modelValue"]),p("span",ee,i(n.value.sku.taking_unit),1)]),_:1}),e(o,{label:"\u76D8\u70B9\u5355\u4F4D",name:"taking_unit"},{default:t(()=>[e(A,{modelValue:n.value.sku.taking_unit,"onUpdate:modelValue":a[3]||(a[3]=u=>n.value.sku.taking_unit=u)},null,8,["modelValue"])]),_:1}),e(o,{label:"\u76D8\u70B9\u5355\u4F4D-sku",name:"taking_unit_sku_count"},{default:t(()=>[e(h,{modelValue:n.value.sku.taking_unit_sku_count,"onUpdate:modelValue":a[4]||(a[4]=u=>n.value.sku.taking_unit_sku_count=u)},null,8,["modelValue"])]),_:1}),e(o,{label:"\u672A\u6253\u5305sku\u6570",name:"shipping_stock_quantity"},{default:t(()=>{var u;return[s(i((u=n.value.sku)==null?void 0:u.shipping_stock_quantity),1)]}),_:1}),e(o,{label:"\u76D8\u70B9\u524D\uFF1A\u5E93\u5B58",name:"before-inventory"},{default:t(()=>{var u;return[s(i((u=n.value.sku)==null?void 0:u.inventory),1)]}),_:1}),e(o,{label:"\u76D8\u70B9\u540E\uFF1A\u5E93\u5B58",name:"after-inventory"},{default:t(()=>{var u;return[s(i((u=n.value.sku)==null?void 0:u.inventory),1)]}),_:1})]),_:1})]),_:1},8,["visible","header","on-overlay-click"])])}}});var _e=L(te,[["__file","/Users/jkguo/workspace/ec-erp-static/src/pages/warehouse/stocktaking.vue"]]);export{_e as default};

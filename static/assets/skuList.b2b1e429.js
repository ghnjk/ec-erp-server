import{_ as W,d as X,r as _,o as Y,M as p,a as l,b as B,c as Z,e as u,w as a,u as ee,g as i,f as D,t as m,h as te,j as ue,I as b,k as ae}from"./index.f716af10.js";import{a as ne,b as le,c as se,d as oe}from"./supplierApis.eaf40298.js";import{l as ie,s as re}from"./skuUtil.c21f20d9.js";const _e=D("br",null,null,-1),ce={class:"table-container"},pe=D("br",null,null,-1),de=D("br",null,null,-1),me={name:"SkuList"},ge=X({...me,setup(ke){const s=_({skuGroup:"",skuName:"",sku:"",supportDays:""}),E=_({sortBy:"avg_sell_quantity",descending:!0}),x=[{width:60,colKey:"erp_sku_image_url",fixed:"left",title:"\u5546\u54C1\u56FE\u7247",align:"center"},{width:120,colKey:"sku_group",fixed:"left",title:"sku\u5206\u7EC4",align:"center",edit:{component:b,props:{autofocus:!0},validateTrigger:"change",abortEditOnEvent:["onEnter","onBlur"],onEdited:async e=>{console.log(e),await y(e.newRowData),await o()},rules:[{required:!0,message:"\u4E0D\u80FD\u4E3A\u7A7A"}],defaultEditable:!1}},{width:120,colKey:"sku_name",fixed:"left",title:"\u5546\u54C1\u540D",align:"center",edit:{component:b,props:{autofocus:!0},validateTrigger:"change",abortEditOnEvent:["onEnter","onBlur"],onEdited:async e=>{console.log(e),await y(e.newRowData),await o()},rules:[{required:!0,message:"\u4E0D\u80FD\u4E3A\u7A7A"}],defaultEditable:!1}},{width:120,colKey:"sku",title:"\u5546\u54C1SKU",align:"center"},{width:120,colKey:"erp_sku_name",title:"BigSeller\u5546\u54C1\u540D",align:"center"},{width:120,colKey:"sku_unit_name",title:"\u91C7\u8D2D\u5355\u4F4D",align:"center",edit:{component:b,props:{autofocus:!0},validateTrigger:"change",abortEditOnEvent:["onEnter","onBlur"],onEdited:async e=>{console.log(e),await y(e.newRowData),await o()},rules:[{required:!0,message:"\u4E0D\u80FD\u4E3A\u7A7A"}],defaultEditable:!1}},{width:120,colKey:"sku_unit_quantity",title:"\u5355\u4F4D\u7684SKU\u6570",align:"center",sortType:"all",sorter:!0,edit:{component:ae,props:{autofocus:!0},validateTrigger:"change",abortEditOnEvent:["onEnter","onBlur"],onEdited:async e=>{console.log(e),await y(e.newRowData),await o()},rules:[{required:!0,message:"\u4E0D\u80FD\u4E3A\u7A7A"}],defaultEditable:!1}},{width:120,colKey:"inventory",sortType:"all",sorter:!0,title:"\u5E93\u5B58-SKU",align:"center"},{width:120,colKey:"inventory_pkg",sortType:"all",sorter:!0,title:"\u5E93\u5B58-\u91C7\u8D2D\u5355\u4F4D",align:"center"},{width:120,colKey:"avg_sell_quantity",title:"\u5E73\u5747\u65E5\u9500-SKU",align:"center",sortType:"all",sorter:!0},{width:120,colKey:"avg_sell_quantity_pkg",title:"\u5E73\u5747\u65E5\u9500-\u91C7\u8D2D\u5355\u4F4D",align:"center",sortType:"all",sorter:!0},{width:120,colKey:"inventory_support_days",title:"\u5E93\u5B58\u652F\u6491\u5929\u6570",align:"center",sortType:"all",sorter:!0},{width:120,colKey:"shipping_stock_quantity",title:"\u6D77\u8FD0\u4E2D-SKU",align:"center",sortType:"all",sorter:!0},{width:120,colKey:"shipping_stock_quantity_pkg",title:"\u6D77\u8FD0\u4E2D-\u91C7\u8D2D\u5355\u4F4D",align:"center",sortType:"all",sorter:!0},{width:120,colKey:"shipping_stock_support_days",title:"\u6D77\u8FD0\u4E2D-\u652F\u6491\u5929\u6570",align:"center",sortType:"all",sorter:!0}],C=_([]),d=_(!1),g=_(1),S=_(0),k=_(10),K=[10,20,50,100],c=_({visible:!1,skus:""});Y(()=>{o(),ie()});const V=e=>{E.value=e,o()},T=({current:e,pageSize:t})=>{g.value=e,k.value=t,o()},U=e=>{if(e.sku_unit_quantity===null||e.sku_unit_quantity===void 0||e.sku_unit_quantity<=0)return e.avg_sell_quantity.toFixed(1);const t=e.avg_sell_quantity/e.sku_unit_quantity;return!e.sku_unit_name||!e.sku_unit_name.trim()||e.sku_unit_name.toLowerCase().includes("pcs")?`${t.toFixed(0)}`:`${t.toFixed(1)} ${e.sku_unit_name.substring(0,1)}`},$=e=>{if(e.sku_unit_quantity===null||e.sku_unit_quantity===void 0||e.sku_unit_quantity<=0)return e.inventory.toFixed(1);const t=e.inventory/e.sku_unit_quantity;return!e.sku_unit_name||!e.sku_unit_name.trim()||e.sku_unit_name.toLowerCase().includes("pcs")?`${t.toFixed(0)}`:`${t.toFixed(1)} ${e.sku_unit_name.substring(0,1)}`},z=e=>{if(e.sku_unit_quantity===null||e.sku_unit_quantity===void 0||e.sku_unit_quantity<=0)return e.shipping_stock_quantity.toFixed(1);const t=e.shipping_stock_quantity/e.sku_unit_quantity;return!e.sku_unit_name||!e.sku_unit_name.trim()||e.sku_unit_name.toLowerCase().includes("pcs")?`${t.toFixed(0)}`:`${t.toFixed(1)} ${e.sku_unit_name.substring(0,1)}`},N=e=>e.shipping_stock_quantity===0?"0":e.avg_sell_quantity===0?"--":(e.shipping_stock_quantity/e.avg_sell_quantity).toFixed(1),y=async e=>{try{await le(e),await p.success("\u66F4\u65B0sku\u6210\u529F\u3002")}catch(t){console.error(t),await p.error(`\u66F4\u65B0sku\u5F02\u5E38: ${t}`)}},P=async()=>{try{const{success_count:e,ignore_count:t,fail_count:F,detail:r}=await se({skus:c.value.skus});console.log("onAddSku response",r),await p.success(`\u6210\u529F\u6DFB\u52A0\uFF1A${e}, \u5931\u8D25\uFF1A${F}\uFF0C \u5FFD\u7565\uFF1A ${t}`),o()}catch(e){console.error(e),await p.error(`\u6DFB\u52A0sku\u5F02\u5E38: ${e}`)}},L=()=>{c.value.visible=!0},G=async()=>{d.value=!0;try{const{update_count:e}=await oe();await p.success(`\u6210\u529F\u540C\u6B65${e}\u4E2Asku`)}catch(e){console.error(e),await p.error(`\u67E5\u8BE2sku\u5F02\u5E38: ${e}`)}d.value=!1},o=async()=>{const e={sku_group:s.value.skuGroup,sku_name:s.value.skuName,sku:s.value.sku,inventory_support_days:s.value.supportDays,current_page:g.value,page_size:k.value,sort:E.value};d.value=!0;try{const t=await ne(e);S.value=t.total,C.value=t.list}catch(t){console.error(t),await p.error(`\u67E5\u8BE2sku\u5F02\u5E38: ${t}`)}d.value=!1};return(e,t)=>{const F=l("t-select"),r=l("t-form-item"),q=l("t-input"),O=l("t-input-number"),v=l("t-button"),f=l("t-space"),A=l("t-form"),h=l("t-col"),w=l("t-row"),R=l("t-image"),I=l("t-table"),M=l("t-pagination"),j=l("t-card"),Q=l("t-alert"),H=l("t-textarea"),J=l("t-dialog");return B(),Z("div",null,[u(j,null,{default:a(()=>[u(w,null,{default:a(()=>[u(h,{span:12},{default:a(()=>[u(A,{layout:"inline"},{default:a(()=>[u(r,{label:"sku\u5206\u7EC4:",name:"skuGroup"},{default:a(()=>[u(F,{modelValue:s.value.skuGroup,"onUpdate:modelValue":t[0]||(t[0]=n=>s.value.skuGroup=n),options:ee(re),clearable:"",filterable:"",placeholder:"-\u8BF7\u9009\u62E9\u5546\u54C1\u5206\u7EC4-",style:{width:"150px",display:"inline-block"}},null,8,["modelValue","options"])]),_:1}),u(r,{label:"\u5546\u54C1\u540D:",name:"skuName"},{default:a(()=>[u(q,{modelValue:s.value.skuName,"onUpdate:modelValue":t[1]||(t[1]=n=>s.value.skuName=n),placeholder:"\u5546\u54C1\u540D"},null,8,["modelValue"])]),_:1}),u(r,{label:"\u5546\u54C1SKU:",name:"sku"},{default:a(()=>[u(q,{modelValue:s.value.sku,"onUpdate:modelValue":t[2]||(t[2]=n=>s.value.sku=n),placeholder:"\u5546\u54C1SKU"},null,8,["modelValue"])]),_:1}),u(r,{label:"\u652F\u6491\u5929\u6570:",name:"supportDays"},{default:a(()=>[u(O,{modelValue:s.value.supportDays,"onUpdate:modelValue":t[3]||(t[3]=n=>s.value.supportDays=n),theme:"column"},null,8,["modelValue"])]),_:1}),u(r,null,{default:a(()=>[u(f,{size:"small",style:{"align-items":"center","margin-left":"30px"}},{default:a(()=>[u(v,{theme:"primary",onClick:o},{default:a(()=>[i("\u67E5\u8BE2")]),_:1})]),_:1}),u(f,{size:"small",style:{"align-items":"center","margin-left":"30px"}},{default:a(()=>[u(v,{theme:"success",onClick:L},{default:a(()=>[i("\u6DFB\u52A0SKU")]),_:1})]),_:1}),u(f,{size:"small",style:{"align-items":"center","margin-left":"30px"}},{default:a(()=>[u(v,{theme:"default",variant:"text",onClick:G},{default:a(()=>[i("\u540C\u6B65\u6240\u6709\u5E93\u5B58")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),_e,D("div",ce,[u(I,{columns:x,data:C.value,"fixed-rows":[0,0],loading:d.value,"max-height":1e3,"show-sort-column-bg-color":!0,sort:E.value,bordered:"",hover:"","row-key":"sku",stripe:"",onSortChange:V},{avg_sell_quantity:a(({row:n})=>[i(m(n.avg_sell_quantity.toFixed(2)),1)]),erp_sku_image_url:a(({row:n})=>[u(R,{src:n.erp_sku_image_url,style:{width:"60px",height:"60px"}},null,8,["src"])]),inventory_pkg:a(({row:n})=>[i(m($(n)),1)]),avg_sell_quantity_pkg:a(({row:n})=>[i(m(U(n)),1)]),shipping_stock_quantity_pkg:a(({row:n})=>[i(m(z(n)),1)]),shipping_stock_support_days:a(({row:n})=>[i(m(N(n)),1)]),_:1},8,["data","loading","sort"]),u(M,{modelValue:g.value,"onUpdate:modelValue":t[4]||(t[4]=n=>g.value=n),pageSize:k.value,"onUpdate:pageSize":t[5]||(t[5]=n=>k.value=n),"page-size-options":K,total:S.value,class:"pagination",onChange:T},null,8,["modelValue","pageSize","total"])])]),_:1}),c.value.visible?(B(),te(J,{key:0,visible:c.value.visible,"onUpdate:visible":t[7]||(t[7]=n=>c.value.visible=n),"cancel-btn":null,"close-on-esc-keydown":!1,"close-on-overlay-click":!1,"confirm-btn":null,header:"\u6DFB\u52A0SKU","show-overlay":"",width:"60%"},{default:a(()=>[u(Q,{message:"\u9700\u8981\u63D0\u524D\u5728bigseller\u6DFB\u52A0\u597Dsku"}),pe,u(A,null,{default:a(()=>[u(r,{label:"sku:",name:"supplier_name"},{default:a(()=>[u(H,{modelValue:c.value.skus,"onUpdate:modelValue":t[6]||(t[6]=n=>c.value.skus=n),autosize:{minRows:3,maxRows:5},name:"description",placeholder:"\u9700\u8981\u6DFB\u52A0\u7684sku\u3002\u591A\u4E2A\u6362\u884C"},null,8,["modelValue"])]),_:1})]),_:1}),de,u(w,null,{default:a(()=>[u(h,{span:9}),u(h,{span:3},{default:a(()=>[u(f,null,{default:a(()=>[u(v,{style:{float:"right"},theme:"primary",onClick:P},{default:a(()=>[i("\u6279\u91CF\u6DFB\u52A0")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["visible"])):ue("v-if",!0)])}}});var De=W(ge,[["__file","/Users/jkguo/workspace/ec-erp-static/src/pages/supply/skuList.vue"]]);export{De as default};

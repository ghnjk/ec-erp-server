import{_ as q,d as M,r as s,a,b,c as x,h as S,w as u,e,g as A,j as w,f as z,t as N,M as m,F as R,s as W,o as Y,v as Z,x as ee,p as te,q as ue}from"./index.55b6982b.js";import{q as ae,p as le,a as ne,b as oe,g as ie,c as se}from"./warehouseApis.98b390aa.js";const re={style:{width:"80%"}},ce={name:"OrderPrintProgressDialog"},_e=M({...ce,setup(C,{expose:$}){const D=s(""),v=s(!1),r=s(null),p=s(null),E=s(!1),d=async()=>{p.value!==null&&clearTimeout(p.value),await P()||(p.value=setTimeout(d,1e3))},F=()=>r.value===null?!1:r.value.pdf_file_url!==null&&r.value.pdf_file_url!==void 0&&r.value.pdf_file_url!=="",P=async()=>{try{const h={task_id:D.value},V=await ae(h);return r.value=V.task,F()?(E.value=!0,console.log("url",r.value.pdf_file_url),window.open(r.value.pdf_file_url,"_blank"),!0):!1}catch(h){return console.error(h),await m.error(`\u67E5\u8BE2\u6253\u5370\u8FDB\u5EA6\u5F02\u5E38: ${h}`),!1}},O=async h=>{D.value=h,E.value=!1,v.value=!0,await d()},B=()=>{p.value!==null&&clearTimeout(p.value),v.value=!1};return $({popupDialog:O}),(h,V)=>{const i=a("t-input"),t=a("t-form-item"),f=a("link-icon"),k=a("t-link"),T=a("t-progress"),n=a("t-collapse-panel"),l=a("t-collapse"),c=a("t-form"),U=a("t-dialog");return b(),x("div",null,[v.value?(b(),S(U,{key:0,visible:v.value,"onUpdate:visible":V[0]||(V[0]=_=>v.value=_),"close-on-esc-keydown":!1,"close-on-overlay-click":!1,"confirm-btn":null,header:"\u6253\u5370\u8BA2\u5355\u4E2D...","show-overlay":"",width:"80%",onCancel:B},{default:u(()=>[e(c,null,{default:u(()=>[e(t,{label:"\u4EFB\u52A1id"},{default:u(()=>{var _;return[e(i,{value:(_=r.value)==null?void 0:_.task_id,disabled:""},null,8,["value"])]}),_:1}),e(t,{label:"\u5F53\u524D\u6B65\u9AA4"},{default:u(()=>{var _;return[e(i,{value:(_=r.value)==null?void 0:_.current_step,current_step:"",disabled:""},null,8,["value"])]}),_:1}),E.value?(b(),S(t,{key:0,label:"\u6253\u5370\u94FE\u63A5"},{default:u(()=>{var _;return[e(k,{href:(_=r.value)==null?void 0:_.pdf_file_url,target:"_blank",theme:"primary",underline:""},{"prefix-icon":u(()=>[e(f)]),default:u(()=>[A(" \u6253\u5370PDF ")]),_:1},8,["href"])]}),_:1})):w("v-if",!0),e(t,{label:"\u8FDB\u5EA6"},{default:u(()=>{var _;return[z("div",re,[e(T,{percentage:(_=r.value)==null?void 0:_.progress,theme:"plump"},null,8,["percentage"])])]}),_:1}),e(l,{"default-value":[]},{default:u(()=>[e(n,{header:"\u5904\u7406\u65E5\u5FD7"},{default:u(()=>{var _;return[z("pre",null,N((_=r.value)==null?void 0:_.logs.join(`
`)),1)]}),_:1})]),_:1})]),_:1})]),_:1},8,["visible"])):w("v-if",!0)])}}});var G=q(_e,[["__file","/Users/jkguo/workspace/ec-erp-static/src/pages/warehouse/components/orderPrintProgressDialog.vue"]]);const pe={name:"OrderPrintConfirmDialog",components:{OrderPrintProgressDialog:G}},de=M({...pe,setup(C,{expose:$}){const D=s(null),v=s(!1),r=s(""),p=s([]),E=s([]),d=s(!1),F=async(i,t)=>{E.value=t,r.value=`\u672C\u6B21\u6253\u5370 ${t.length} \u5355 / \u5171 ${i} \u5355`,v.value=!0,d.value=!0,await P(),d.value=!1},P=async()=>{try{p.value=[];const i={order_list:E.value},t=await le(i);return t.need_manual_mark_sku_list.forEach(f=>{p.value.push({sku:f.sku,image_url:f.image_url,desc:f.desc,picking_unit:0,picking_unit_name:"pcs",picking_sku_name:f.sku,support_pkg_picking:!1,pkg_picking_unit:0,pkg_picking_unit_name:"pk"})}),console.log("manualMarkSkuList",p.value),p.value.length>0?(await m.info("\u9700\u8981\u8865\u5145sku\u62E3\u8D27\u5907\u6CE8."),null):(console.log("\u63D0\u4EA4\u6253\u5370\u8BA2\u5355\u6210\u529F\uFF0C\u9762\u5355id",t.task_id),t.task_id)}catch(i){console.error(i),await m.error(`\u6253\u5370\u8BA2\u5355\u5931\u8D25: ${i}`)}return null},O=async()=>{if(p.value.length===0)return!0;let i=!0;if(p.value.forEach(t=>{t.picking_unit<=0&&(m.info(`${t.sku} picking_unit \u672A\u586B`),i=!1),t.picking_unit_name===""&&(m.info(`${t.sku} picking_unit_name \u672A\u586B`),i=!1),t.picking_sku_name===""&&(m.info(`${t.sku} picking_sku_name \u672A\u586B`),i=!1),t.support_pkg_picking&&(t.pkg_picking_unit<=0&&(m.info(`${t.sku} pkg_picking_unit \u672A\u586B`),i=!1),t.pkg_picking_unit_name===""&&(m.info(`${t.sku} pkg_picking_unit_name \u672A\u586B`),i=!1))}),!i)return!1;try{const t={manual_mark_sku_list:p.value};return await ne(t),!0}catch(t){return console.error(t),await m.error(`\u6DFB\u52A0sku\u62E3\u8D27\u5907\u6CE8\u5931\u8D25: ${t}`),!1}},B=async i=>{try{const f=await oe({task_id:i});console.log("task",f),await D.value.popupDialog(i),v.value=!1}catch(t){console.error(t),await m.error(`\u542F\u52A8\u540E\u53F0\u4EFB\u52A1\u5931\u8D25: ${t}`),d.value=!1}},h=()=>{v.value=!1},V=async()=>{if(d.value)return;if(d.value=!0,!await O()){d.value=!1;return}const t=await P();t!=null?await B(t):d.value=!1};return $({popupDialog:F}),(i,t)=>{const f=a("t-input"),k=a("t-form-item"),T=a("t-list-item-meta"),n=a("t-input-number"),l=a("t-checkbox"),c=a("t-space"),U=a("t-list-item"),_=a("t-list"),K=a("t-form"),I=a("t-loading"),L=a("t-dialog");return b(),x("div",null,[v.value?(b(),S(L,{key:0,visible:v.value,"onUpdate:visible":t[0]||(t[0]=o=>v.value=o),"close-on-esc-keydown":!1,"close-on-overlay-click":!1,"confirm-btn":"\u786E\u8BA4 & \u63D0\u4EA4\u6253\u5370",header:"\u8BA2\u5355\u6253\u5370\u4FE1\u606F\u786E\u8BA4","show-overlay":"",width:"80%",onCancel:h,onConfirm:V},{default:u(()=>[e(I,{loading:d.value},{default:u(()=>[e(K,null,{default:u(()=>[e(k,{label:"\u8BA2\u5355\u6570"},{default:u(()=>[e(f,{value:r.value,disabled:""},null,8,["value"])]),_:1}),e(k,{label:"sku\u62E3\u8D27\u5907\u6CE8"},{default:u(()=>[e(c,{direction:"vertical"},{default:u(()=>[e(_,{split:!0,stripe:""},{default:u(()=>[(b(!0),x(R,null,W(p.value,o=>(b(),S(U,{key:o==null?void 0:o.sku},{default:u(()=>[e(T,{description:o.desc,image:o.image_url,title:o==null?void 0:o.sku},null,8,["description","image","title"]),e(c,{direction:"vertical"},{default:u(()=>[e(k,{label:"1\u62E3\u8D27\u5355\u4F4D="},{default:u(()=>[e(n,{modelValue:o.picking_unit,"onUpdate:modelValue":y=>o.picking_unit=y},null,8,["modelValue","onUpdate:modelValue"]),A(" SKU ")]),_:2},1024),e(k,{label:"\u62E3\u8D27\u5355\u4F4D\u540D"},{default:u(()=>[e(f,{modelValue:o.picking_unit_name,"onUpdate:modelValue":y=>o.picking_unit_name=y},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(k,{label:"\u6DFB\u52A0pkg\u6253\u5305"},{default:u(()=>[e(l,{modelValue:o.support_pkg_picking,"onUpdate:modelValue":y=>o.support_pkg_picking=y},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),o.support_pkg_picking?(b(),S(k,{key:0,label:"1 PKG ="},{default:u(()=>[e(n,{modelValue:o.pkg_picking_unit,"onUpdate:modelValue":y=>o.pkg_picking_unit=y},null,8,["modelValue","onUpdate:modelValue"]),A(" SKU ")]),_:2},1024)):w("v-if",!0),o.support_pkg_picking?(b(),S(k,{key:1,label:"PKG\u6253\u5305\u5355\u4F4D"},{default:u(()=>[e(f,{modelValue:o.pkg_picking_unit_name,"onUpdate:modelValue":y=>o.pkg_picking_unit_name=y},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)):w("v-if",!0),e(k,{label:"\u62E3\u8D27sku\u540D"},{default:u(()=>[e(f,{modelValue:o.picking_sku_name,"onUpdate:modelValue":y=>o.picking_sku_name=y},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),w("          <t-form-item>"),w('            <t-button theme="default" @click="onClose">\u5173\u95ED</t-button>'),w('            <t-button :disabled="isLoading" theme="primary" @click="onSubmitPrintOrder">\u786E\u8BA4 & \u63D0\u4EA4\u6253\u5370</t-button>'),w("          </t-form-item>")]),_:1})]),_:1},8,["loading"])]),_:1},8,["visible"])):w("v-if",!0),e(G,{ref_key:"orderPrintProgressDialog",ref:D},null,512)])}}});var Q=q(de,[["__file","/Users/jkguo/workspace/ec-erp-static/src/pages/warehouse/components/orderPrintConfirmDialog.vue"]]);const H=C=>(te("data-v-cf49c91e"),C=C(),ue(),C),fe=H(()=>z("br",null,null,-1)),ge=H(()=>z("br",null,null,-1)),me={class:"table-container"},ve={name:"PrintOrder",components:{OrderPrintConfirmDialog:Q}},ke=M({...ve,setup(C){const $=s("\u672A\u767B\u5F55"),D=s(null),v=[{width:50,colKey:"row-select",type:"multiple",checkProps:{allowUncheck:!0},align:"center"},{width:120,colKey:"id",title:"id",align:"center"},{width:60,colKey:"platformOrderId",title:"\u8BA2\u5355\u53F7",align:"center"},{width:120,colKey:"packageNo",title:"\u5305\u88F9\u53F7",align:"center"},{width:120,colKey:"shippingCarrierName",title:"\u7269\u6D41",align:"center"},{width:120,colKey:"trackingNo",title:"\u8FD0\u5355\u53F7",align:"center"},{width:120,colKey:"multilingualViewStatus",title:"\u72B6\u6001",align:"center"},{width:120,colKey:"amount",title:"\u91D1\u989D",align:"center"},{width:120,colKey:"platform",title:"\u5E73\u53F0",align:"center"}],r=s([]),p=s(!1),E=s([]),d=s(1),F=s(0),P=s(300),O=[10,20,50,100,200,300,500,1e3,5e3],B=s([]),h=s(null);Y(async()=>{const{query:n}=Z(),{token:l}=n;try{const c=await ee(l);$.value=c.userName,await V()}catch(c){console.error(c),await m.error(`\u767B\u9646\u5F02\u5E38: ${c}`)}});const V=async()=>{try{const l=(await ie()).ship_provider_list;console.log("shipProviderList",l),B.value=[],l.forEach(c=>{B.value.push({label:`${c.name}(${c.count})`,value:c.id})})}catch(n){console.error(n),await m.error(`\u67E5\u8BE2\u8BA2\u5355\u7EDF\u8BA1\u4FE1\u606F\u5F02\u5E38: ${n}`)}},i=(n,l)=>{D.value=n,k()},t=(n,{selectedRowData:l})=>{E.value=n},f=({current:n,pageSize:l})=>{d.value=n,P.value=l,k()},k=async()=>{if(p.value=!0,await V(),D.value===null){p.value=!1;return}try{const n={shipping_provider_id:D.value,current_page:d.value,page_size:P.value};E.value=[];const l=await se(n);F.value=l.total,r.value=l.list,console.log("waitOrder",F.value,r.value)}catch(n){console.error(n),await m.error(`\u67E5\u8BE2\u8BA2\u5355\u4FE1\u606F\u5F02\u5E38: ${n}`)}p.value=!1},T=async()=>{const n=new Set;if(E.value.forEach(c=>{n.add(c)}),console.log("selected: ",n),n.size<=0){m.info("\u8BF7\u5148\u9009\u4E2D\u9700\u8981\u6253\u5370\u7684\u8BA2\u5355.");return}const l=[];if(r.value.forEach(c=>{n.has(c.id)&&l.push(c)}),l.length!=n.size){m.error("\u9009\u4E2D\u7684\u8BA2\u5355\u4FE1\u606F\u7F3A\u5931\u3002.");return}h.value.popupDialog(F.value,l)};return(n,l)=>{const c=a("t-radio"),U=a("t-space"),_=a("t-radio-group"),K=a("t-form-item"),I=a("t-button"),L=a("t-form"),o=a("t-col"),y=a("t-row"),j=a("t-pagination"),J=a("t-table"),X=a("t-card");return b(),x("div",null,[e(X,null,{default:u(()=>[fe,e(y,null,{default:u(()=>[e(o,{span:12},{default:u(()=>[e(L,{layout:"inline"},{default:u(()=>[e(K,{label:"\u7269\u6D41\u65B9\u5F0F"},{default:u(()=>[e(_,{modelValue:D.value,"onUpdate:modelValue":l[0]||(l[0]=g=>D.value=g),name:"shipping",variant:"default-filled",onChange:i},{default:u(()=>[e(U,{direction:"vertical"},{default:u(()=>[(b(!0),x(R,null,W(B.value,g=>(b(),S(c,{value:g.value},{default:u(()=>[A(N(g.label),1)]),_:2},1032,["value"]))),256))]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(K,null,{default:u(()=>[e(U,{size:"small",style:{"align-items":"center","margin-left":"30px"}},{default:u(()=>[e(I,{theme:"default",onClick:k},{default:u(()=>[A("\u5237 \u65B0")]),_:1}),e(I,{theme:"primary",onClick:T},{default:u(()=>[A("\u6253 \u5370")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),ge,z("div",me,[e(j,{modelValue:d.value,"onUpdate:modelValue":l[1]||(l[1]=g=>d.value=g),pageSize:P.value,"onUpdate:pageSize":l[2]||(l[2]=g=>P.value=g),"page-size-options":O,total:F.value,class:"pagination",onChange:f},null,8,["modelValue","pageSize","total"]),e(J,{columns:v,data:r.value,loading:p.value,"select-on-row-click":!0,"selected-row-keys":E.value,bordered:"",hover:"","row-key":"id",stripe:"",onSelectChange:t},{multilingualViewStatus:u(({row:g})=>[A(N(g.printLabelMark>0?"[\u5DF2\u6253\u5370]"+g.multilingualViewStatus:g.multilingualViewStatus),1)]),_:1},8,["data","loading","selected-row-keys"]),e(j,{modelValue:d.value,"onUpdate:modelValue":l[3]||(l[3]=g=>d.value=g),pageSize:P.value,"onUpdate:pageSize":l[4]||(l[4]=g=>P.value=g),"page-size-options":O,total:F.value,class:"pagination",onChange:f},null,8,["modelValue","pageSize","total"])])]),_:1}),e(Q,{ref_key:"orderPrintConfirmDialog",ref:h},null,512)])}}});var be=q(ke,[["__scopeId","data-v-cf49c91e"],["__file","/Users/jkguo/workspace/ec-erp-static/src/pages/warehouse/printOrder.vue"]]);export{be as default};

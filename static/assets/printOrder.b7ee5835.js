import{i as S,_ as q,d as z,r as s,a,b as y,c as x,h as V,w as u,e,g as A,j as K,f as I,t as N,M as m,F as L,n as M,o as Z,p as ee,q as te,s as ue,v as ne}from"./index.c4cce00e.js";const ae=()=>S.post("/erp_api/warehouse/get_wait_print_order_ship_provider_list",{}),le=d=>S.post("/erp_api/warehouse/search_wait_print_order",d),oe=d=>S.post("/erp_api/warehouse/pre_submit_print_order",d),ie=d=>S.post("/erp_api/warehouse/start_run_print_order_task",d),re=d=>S.post("/erp_api/warehouse/submit_manual_mark_sku_picking_note",d),se=d=>S.post("/erp_api/warehouse/query_print_order_task",d),ce={style:{width:"80%"}},_e={name:"OrderPrintProgressDialog"},pe=z({..._e,setup(d,{expose:C}){const b=s(""),k=s(!1),r=s(null),c=s(null),D=s(!1),w=async()=>{c.value!==null&&clearTimeout(c.value),await F()||(c.value=setTimeout(w,1e3))},E=()=>r.value===null?!1:r.value.pdf_file_url!==null&&r.value.pdf_file_url!==void 0&&r.value.pdf_file_url!=="",F=async()=>{try{const n={task_id:b.value},t=await se(n);return r.value=t.task,E()?(D.value=!0,console.log("url",r.value.pdf_file_url),window.open(r.value.pdf_file_url,"_blank"),!0):!1}catch(n){return console.error(n),await m.error(`\u67E5\u8BE2\u6253\u5370\u8FDB\u5EA6\u5F02\u5E38: ${n}`),!1}},O=async n=>{b.value=n,D.value=!1,k.value=!0,await w()},B=()=>{c.value!==null&&clearTimeout(c.value),k.value=!1};return C({popupDialog:O}),(n,t)=>{const f=a("t-input"),g=a("t-form-item"),U=a("link-icon"),P=a("t-link"),$=a("t-progress"),l=a("t-collapse-panel"),i=a("t-collapse"),_=a("t-form"),T=a("t-dialog");return y(),x("div",null,[k.value?(y(),V(T,{key:0,visible:k.value,"onUpdate:visible":t[0]||(t[0]=p=>k.value=p),"close-on-esc-keydown":!1,"close-on-overlay-click":!1,"confirm-btn":null,header:"\u6253\u5370\u8BA2\u5355\u4E2D...","show-overlay":"",width:"80%",onCancel:B},{default:u(()=>[e(_,null,{default:u(()=>[e(g,{label:"\u4EFB\u52A1id"},{default:u(()=>{var p;return[e(f,{value:(p=r.value)==null?void 0:p.task_id,disabled:""},null,8,["value"])]}),_:1}),e(g,{label:"\u5F53\u524D\u6B65\u9AA4"},{default:u(()=>{var p;return[e(f,{value:(p=r.value)==null?void 0:p.current_step,current_step:"",disabled:""},null,8,["value"])]}),_:1}),D.value?(y(),V(g,{key:0,label:"\u6253\u5370\u94FE\u63A5"},{default:u(()=>{var p;return[e(P,{href:(p=r.value)==null?void 0:p.pdf_file_url,target:"_blank",theme:"primary",underline:""},{"prefix-icon":u(()=>[e(U)]),default:u(()=>[A(" \u6253\u5370PDF ")]),_:1},8,["href"])]}),_:1})):K("v-if",!0),e(g,{label:"\u8FDB\u5EA6"},{default:u(()=>[I("div",ce,[e($,{percentage:r.value.progress,theme:"plump"},null,8,["percentage"])])]),_:1}),e(i,{"default-value":[]},{default:u(()=>[e(l,{header:"\u5904\u7406\u65E5\u5FD7"},{default:u(()=>{var p;return[I("pre",null,N((p=r.value)==null?void 0:p.logs.join(`
`)),1)]}),_:1})]),_:1})]),_:1})]),_:1},8,["visible"])):K("v-if",!0)])}}});var j=q(pe,[["__file","/Users/jkguo/workspace/ec-erp-static/src/pages/warehouse/components/orderPrintProgressDialog.vue"]]);const de={name:"OrderPrintConfirmDialog",components:{OrderPrintProgressDialog:j}},fe=z({...de,setup(d,{expose:C}){const b=s(null),k=s(!1),r=s(""),c=s([]),D=s([]),w=async(n,t)=>{D.value=t,r.value=`\u672C\u6B21\u6253\u5370 ${t.length} \u5355 / \u5171 ${n} \u5355`,k.value=!0,await E()},E=async()=>{try{const n={order_list:D.value},t=await oe(n);return c.value=[],t.need_manual_mark_sku_list.forEach(f=>{c.value.push({sku:f.sku,image_url:f.image_url,desc:f.desc,picking_unit:0,picking_unit_name:"pcs",picking_sku_name:f.sku,support_pkg_picking:!1,pkg_picking_unit:0,pkg_picking_unit_name:"pkg"})}),console.log("manualMarkSkuList",c.value),c.value.length>0?(await m.info("\u9700\u8981\u8865\u5145sku\u62E3\u8D27\u5907\u6CE8."),null):(console.log("\u63D0\u4EA4\u6253\u5370\u8BA2\u5355\u6210\u529F\uFF0C\u9762\u5355id",t.task_id),t.task_id)}catch(n){console.error(n),await m.error(`\u6253\u5370\u8BA2\u5355\u5931\u8D25: ${n}`)}return null},F=async()=>{if(c.value.length===0)return!0;let n=!0;if(c.value.forEach(t=>{t.picking_unit<=0&&(m.info(`${t.sku} picking_unit \u672A\u586B`),n=!1),t.picking_unit_name===""&&(m.info(`${t.sku} picking_unit_name \u672A\u586B`),n=!1),t.picking_sku_name===""&&(m.info(`${t.sku} picking_sku_name \u672A\u586B`),n=!1),t.support_pkg_picking&&(t.pkg_picking_unit<=0&&(m.info(`${t.sku} pkg_picking_unit \u672A\u586B`),n=!1),t.pkg_picking_unit_name===""&&(m.info(`${t.sku} pkg_picking_unit_name \u672A\u586B`),n=!1))}),!n)return!1;try{const t={manual_mark_sku_list:c.value};return await re(t),!0}catch(t){return console.error(t),await m.error(`\u6DFB\u52A0sku\u62E3\u8D27\u5907\u6CE8\u5931\u8D25: ${t}`),!1}},O=async n=>{try{const f=await ie({task_id:n});console.log("task",f),k.value=!1,b.value.popupDialog(n)}catch(t){console.error(t),await m.error(`\u542F\u52A8\u540E\u53F0\u4EFB\u52A1\u5931\u8D25: ${t}`)}},B=async()=>{if(!await F())return;const t=await E();t!=null&&await O(t)};return C({popupDialog:w}),(n,t)=>{const f=a("t-input"),g=a("t-form-item"),U=a("t-list-item-meta"),P=a("t-input-number"),$=a("t-checkbox"),l=a("t-space"),i=a("t-list-item"),_=a("t-list"),T=a("t-form"),p=a("t-dialog");return y(),x("div",null,[k.value?(y(),V(p,{key:0,visible:k.value,"onUpdate:visible":t[0]||(t[0]=o=>k.value=o),"close-on-esc-keydown":!1,"close-on-overlay-click":!1,"confirm-btn":"\u786E\u8BA4 & \u63D0\u4EA4\u6253\u5370",header:"\u8BA2\u5355\u6253\u5370\u4FE1\u606F\u786E\u8BA4","show-overlay":"",width:"80%",onConfirm:B},{default:u(()=>[e(T,null,{default:u(()=>[e(g,{label:"\u8BA2\u5355\u6570"},{default:u(()=>[e(f,{value:r.value,disabled:""},null,8,["value"])]),_:1}),e(g,{label:"sku\u62E3\u8D27\u5907\u6CE8"},{default:u(()=>[e(l,{direction:"vertical"},{default:u(()=>[e(_,{split:!0,stripe:""},{default:u(()=>[(y(!0),x(L,null,M(c.value,o=>(y(),V(i,{key:o==null?void 0:o.sku},{default:u(()=>[e(U,{description:o.desc,image:o.image_url,title:o==null?void 0:o.sku},null,8,["description","image","title"]),e(l,{direction:"vertical"},{default:u(()=>[e(g,{label:"1\u62E3\u8D27\u5355\u4F4D="},{default:u(()=>[e(P,{modelValue:o.picking_unit,"onUpdate:modelValue":v=>o.picking_unit=v},null,8,["modelValue","onUpdate:modelValue"]),A(" SKU ")]),_:2},1024),e(g,{label:"\u62E3\u8D27\u5355\u4F4D\u540D"},{default:u(()=>[e(f,{modelValue:o.picking_unit_name,"onUpdate:modelValue":v=>o.picking_unit_name=v},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(g,{label:"\u6DFB\u52A0pkg\u6253\u5305"},{default:u(()=>[e($,{modelValue:o.support_pkg_picking,"onUpdate:modelValue":v=>o.support_pkg_picking=v},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),o.support_pkg_picking?(y(),V(g,{key:0,label:"1 PKG ="},{default:u(()=>[e(P,{modelValue:o.pkg_picking_unit,"onUpdate:modelValue":v=>o.pkg_picking_unit=v},null,8,["modelValue","onUpdate:modelValue"]),A(" SKU ")]),_:2},1024)):K("v-if",!0),o.support_pkg_picking?(y(),V(g,{key:1,label:"PKG\u6253\u5305\u5355\u4F4D"},{default:u(()=>[e(f,{modelValue:o.pkg_picking_unit_name,"onUpdate:modelValue":v=>o.pkg_picking_unit_name=v},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)):K("v-if",!0),e(g,{label:"\u62E3\u8D27sku\u540D"},{default:u(()=>[e(f,{modelValue:o.picking_sku_name,"onUpdate:modelValue":v=>o.picking_sku_name=v},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["visible"])):K("v-if",!0),e(j,{ref_key:"orderPrintProgressDialog",ref:b},null,512)])}}});var R=q(fe,[["__file","/Users/jkguo/workspace/ec-erp-static/src/pages/warehouse/components/orderPrintConfirmDialog.vue"]]);const W=d=>(ue("data-v-cf49c91e"),d=d(),ne(),d),ge=W(()=>I("br",null,null,-1)),me=W(()=>I("br",null,null,-1)),ke={class:"table-container"},ve={name:"PrintOrder",components:{OrderPrintConfirmDialog:R}},he=z({...ve,setup(d){const C=s("\u672A\u767B\u5F55"),b=s(null),k=[{width:50,colKey:"row-select",type:"multiple",checkProps:{allowUncheck:!0},align:"center"},{width:120,colKey:"id",title:"id",align:"center"},{width:60,colKey:"platformOrderId",title:"\u8BA2\u5355\u53F7",align:"center"},{width:120,colKey:"packageNo",title:"\u5305\u88F9\u53F7",align:"center"},{width:120,colKey:"shippingCarrierName",title:"\u7269\u6D41",align:"center"},{width:120,colKey:"trackingNo",title:"\u8FD0\u5355\u53F7",align:"center"},{width:120,colKey:"multilingualViewStatus",title:"\u72B6\u6001",align:"center"},{width:120,colKey:"amount",title:"\u91D1\u989D",align:"center"},{width:120,colKey:"platform",title:"\u5E73\u53F0",align:"center"}],r=s([]),c=s(!1),D=s([]),w=s(1),E=s(0),F=s(500),O=[10,20,50,100,200,500,1e3],B=s([]),n=s(null);Z(async()=>{const{query:l}=ee(),{token:i}=l;try{const _=await te(i);C.value=_.userName,await t()}catch(_){console.error(_),await m.error(`\u767B\u9646\u5F02\u5E38: ${_}`)}});const t=async()=>{try{const i=(await ae()).ship_provider_list;console.log("shipProviderList",i),B.value=[],i.forEach(_=>{B.value.push({label:`${_.name}(${_.count})`,value:_.id})})}catch(l){console.error(l),await m.error(`\u67E5\u8BE2\u8BA2\u5355\u7EDF\u8BA1\u4FE1\u606F\u5F02\u5E38: ${l}`)}},f=(l,i)=>{b.value=l,P()},g=(l,{selectedRowData:i})=>{D.value=l},U=({current:l,pageSize:i})=>{w.value=l,F.value=i,P()},P=async()=>{if(c.value=!0,await t(),b.value===null){c.value=!1;return}try{const l={shipping_provider_id:b.value,current_page:w.value,page_size:F.value};D.value=[];const i=await le(l);E.value=i.total,r.value=i.list,console.log("waitOrder",E.value,r.value)}catch(l){console.error(l),await m.error(`\u67E5\u8BE2\u8BA2\u5355\u4FE1\u606F\u5F02\u5E38: ${l}`)}c.value=!1},$=async()=>{const l=new Set;if(D.value.forEach(_=>{l.add(_)}),console.log("selected: ",l),l.size<=0){m.info("\u8BF7\u5148\u9009\u4E2D\u9700\u8981\u6253\u5370\u7684\u8BA2\u5355.");return}const i=[];if(r.value.forEach(_=>{l.has(_.id)&&i.push(_)}),i.length!=l.size){m.error("\u9009\u4E2D\u7684\u8BA2\u5355\u4FE1\u606F\u7F3A\u5931\u3002.");return}n.value.popupDialog(E.value,i)};return(l,i)=>{const _=a("t-radio-button"),T=a("t-radio-group"),p=a("t-form-item"),o=a("t-button"),v=a("t-space"),G=a("t-form"),Q=a("t-col"),H=a("t-row"),J=a("t-table"),X=a("t-pagination"),Y=a("t-card");return y(),x("div",null,[e(Y,null,{default:u(()=>[ge,e(H,null,{default:u(()=>[e(Q,{span:12},{default:u(()=>[e(G,{layout:"inline"},{default:u(()=>[e(p,{label:"\u7269\u6D41\u65B9\u5F0F"},{default:u(()=>[e(T,{modelValue:b.value,"onUpdate:modelValue":i[0]||(i[0]=h=>b.value=h),name:"shipping",variant:"default-filled",onChange:f},{default:u(()=>[(y(!0),x(L,null,M(B.value,h=>(y(),V(_,{value:h.value},{default:u(()=>[A(N(h.label),1)]),_:2},1032,["value"]))),256))]),_:1},8,["modelValue"])]),_:1}),e(p,null,{default:u(()=>[e(v,{size:"small",style:{"align-items":"center","margin-left":"30px"}},{default:u(()=>[e(o,{theme:"default",onClick:P},{default:u(()=>[A("\u5237 \u65B0")]),_:1}),e(o,{theme:"primary",onClick:$},{default:u(()=>[A("\u6253 \u5370")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),me,I("div",ke,[e(J,{columns:k,data:r.value,loading:c.value,"select-on-row-click":!0,"selected-row-keys":D.value,bordered:"",hover:"","row-key":"id",stripe:"",onSelectChange:g},{multilingualViewStatus:u(({row:h})=>[A(N(h.printLabelMark>0?"[\u5DF2\u6253\u5370]"+h.multilingualViewStatus:h.multilingualViewStatus),1)]),_:1},8,["data","loading","selected-row-keys"]),e(X,{modelValue:w.value,"onUpdate:modelValue":i[1]||(i[1]=h=>w.value=h),pageSize:F.value,"onUpdate:pageSize":i[2]||(i[2]=h=>F.value=h),"page-size-options":O,total:E.value,class:"pagination",onChange:U},null,8,["modelValue","pageSize","total"])])]),_:1}),e(R,{ref_key:"orderPrintConfirmDialog",ref:n},null,512)])}}});var be=q(he,[["__scopeId","data-v-cf49c91e"],["__file","/Users/jkguo/workspace/ec-erp-static/src/pages/warehouse/printOrder.vue"]]);export{be as default};

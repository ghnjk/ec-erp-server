import{_ as z,d as M,r,a,b,c as K,h as A,w as u,e,g as S,j as w,f as x,t as q,M as m,F as j,n as R,o as Y,p as Z,q as ee,s as te,v as ue}from"./index.c73535df.js";import{q as ae,p as le,s as ne,a as oe,g as ie,b as re}from"./warehouseApis.d80b46cf.js";const se={style:{width:"80%"}},ce={name:"OrderPrintProgressDialog"},_e=M({...ce,setup(C,{expose:U}){const D=r(""),g=r(!1),s=r(null),p=r(null),E=r(!1),d=async()=>{p.value!==null&&clearTimeout(p.value),await P()||(p.value=setTimeout(d,1e3))},B=()=>s.value===null?!1:s.value.pdf_file_url!==null&&s.value.pdf_file_url!==void 0&&s.value.pdf_file_url!=="",P=async()=>{try{const v={task_id:D.value},F=await ae(v);return s.value=F.task,B()?(E.value=!0,console.log("url",s.value.pdf_file_url),window.open(s.value.pdf_file_url,"_blank"),!0):!1}catch(v){return console.error(v),await m.error(`\u67E5\u8BE2\u6253\u5370\u8FDB\u5EA6\u5F02\u5E38: ${v}`),!1}},$=async v=>{D.value=v,E.value=!1,g.value=!0,await d()},V=()=>{p.value!==null&&clearTimeout(p.value),g.value=!1};return U({popupDialog:$}),(v,F)=>{const i=a("t-input"),t=a("t-form-item"),f=a("link-icon"),k=a("t-link"),T=a("t-progress"),l=a("t-collapse-panel"),n=a("t-collapse"),c=a("t-form"),O=a("t-dialog");return b(),K("div",null,[g.value?(b(),A(O,{key:0,visible:g.value,"onUpdate:visible":F[0]||(F[0]=_=>g.value=_),"close-on-esc-keydown":!1,"close-on-overlay-click":!1,"confirm-btn":null,header:"\u6253\u5370\u8BA2\u5355\u4E2D...","show-overlay":"",width:"80%",onCancel:V},{default:u(()=>[e(c,null,{default:u(()=>[e(t,{label:"\u4EFB\u52A1id"},{default:u(()=>{var _;return[e(i,{value:(_=s.value)==null?void 0:_.task_id,disabled:""},null,8,["value"])]}),_:1}),e(t,{label:"\u5F53\u524D\u6B65\u9AA4"},{default:u(()=>{var _;return[e(i,{value:(_=s.value)==null?void 0:_.current_step,current_step:"",disabled:""},null,8,["value"])]}),_:1}),E.value?(b(),A(t,{key:0,label:"\u6253\u5370\u94FE\u63A5"},{default:u(()=>{var _;return[e(k,{href:(_=s.value)==null?void 0:_.pdf_file_url,target:"_blank",theme:"primary",underline:""},{"prefix-icon":u(()=>[e(f)]),default:u(()=>[S(" \u6253\u5370PDF ")]),_:1},8,["href"])]}),_:1})):w("v-if",!0),e(t,{label:"\u8FDB\u5EA6"},{default:u(()=>{var _;return[x("div",se,[e(T,{percentage:(_=s.value)==null?void 0:_.progress,theme:"plump"},null,8,["percentage"])])]}),_:1}),e(n,{"default-value":[]},{default:u(()=>[e(l,{header:"\u5904\u7406\u65E5\u5FD7"},{default:u(()=>{var _;return[x("pre",null,q((_=s.value)==null?void 0:_.logs.join(`
`)),1)]}),_:1})]),_:1})]),_:1})]),_:1},8,["visible"])):w("v-if",!0)])}}});var W=z(_e,[["__file","/Users/jkguo/workspace/ec-erp-static/src/pages/warehouse/components/orderPrintProgressDialog.vue"]]);const pe={name:"OrderPrintConfirmDialog",components:{OrderPrintProgressDialog:W}},de=M({...pe,setup(C,{expose:U}){const D=r(null),g=r(!1),s=r(""),p=r([]),E=r([]),d=r(!1),B=async(i,t)=>{E.value=t,s.value=`\u672C\u6B21\u6253\u5370 ${t.length} \u5355 / \u5171 ${i} \u5355`,g.value=!0,d.value=!0,await P(),d.value=!1},P=async()=>{try{p.value=[];const i={order_list:E.value},t=await le(i);return t.need_manual_mark_sku_list.forEach(f=>{p.value.push({sku:f.sku,image_url:f.image_url,desc:f.desc,picking_unit:0,picking_unit_name:"pcs",picking_sku_name:f.sku,support_pkg_picking:!1,pkg_picking_unit:0,pkg_picking_unit_name:"pk"})}),console.log("manualMarkSkuList",p.value),p.value.length>0?(await m.info("\u9700\u8981\u8865\u5145sku\u62E3\u8D27\u5907\u6CE8."),null):(console.log("\u63D0\u4EA4\u6253\u5370\u8BA2\u5355\u6210\u529F\uFF0C\u9762\u5355id",t.task_id),t.task_id)}catch(i){console.error(i),await m.error(`\u6253\u5370\u8BA2\u5355\u5931\u8D25: ${i}`)}return null},$=async()=>{if(p.value.length===0)return!0;let i=!0;if(p.value.forEach(t=>{t.picking_unit<=0&&(m.info(`${t.sku} picking_unit \u672A\u586B`),i=!1),t.picking_unit_name===""&&(m.info(`${t.sku} picking_unit_name \u672A\u586B`),i=!1),t.picking_sku_name===""&&(m.info(`${t.sku} picking_sku_name \u672A\u586B`),i=!1),t.support_pkg_picking&&(t.pkg_picking_unit<=0&&(m.info(`${t.sku} pkg_picking_unit \u672A\u586B`),i=!1),t.pkg_picking_unit_name===""&&(m.info(`${t.sku} pkg_picking_unit_name \u672A\u586B`),i=!1))}),!i)return!1;try{const t={manual_mark_sku_list:p.value};return await ne(t),!0}catch(t){return console.error(t),await m.error(`\u6DFB\u52A0sku\u62E3\u8D27\u5907\u6CE8\u5931\u8D25: ${t}`),!1}},V=async i=>{try{const f=await oe({task_id:i});console.log("task",f),await D.value.popupDialog(i),g.value=!1}catch(t){console.error(t),await m.error(`\u542F\u52A8\u540E\u53F0\u4EFB\u52A1\u5931\u8D25: ${t}`),d.value=!1}},v=()=>{g.value=!1},F=async()=>{if(d.value)return;if(d.value=!0,!await $()){d.value=!1;return}const t=await P();t!=null?await V(t):d.value=!1};return U({popupDialog:B}),(i,t)=>{const f=a("t-input"),k=a("t-form-item"),T=a("t-list-item-meta"),l=a("t-input-number"),n=a("t-checkbox"),c=a("t-space"),O=a("t-list-item"),_=a("t-list"),I=a("t-form"),L=a("t-loading"),N=a("t-dialog");return b(),K("div",null,[g.value?(b(),A(N,{key:0,visible:g.value,"onUpdate:visible":t[0]||(t[0]=o=>g.value=o),"close-on-esc-keydown":!1,"close-on-overlay-click":!1,"confirm-btn":"\u786E\u8BA4 & \u63D0\u4EA4\u6253\u5370",header:"\u8BA2\u5355\u6253\u5370\u4FE1\u606F\u786E\u8BA4","show-overlay":"",width:"80%",onCancel:v,onConfirm:F},{default:u(()=>[e(L,{loading:d.value},{default:u(()=>[e(I,null,{default:u(()=>[e(k,{label:"\u8BA2\u5355\u6570"},{default:u(()=>[e(f,{value:s.value,disabled:""},null,8,["value"])]),_:1}),e(k,{label:"sku\u62E3\u8D27\u5907\u6CE8"},{default:u(()=>[e(c,{direction:"vertical"},{default:u(()=>[e(_,{split:!0,stripe:""},{default:u(()=>[(b(!0),K(j,null,R(p.value,o=>(b(),A(O,{key:o==null?void 0:o.sku},{default:u(()=>[e(T,{description:o.desc,image:o.image_url,title:o==null?void 0:o.sku},null,8,["description","image","title"]),e(c,{direction:"vertical"},{default:u(()=>[e(k,{label:"1\u62E3\u8D27\u5355\u4F4D="},{default:u(()=>[e(l,{modelValue:o.picking_unit,"onUpdate:modelValue":h=>o.picking_unit=h},null,8,["modelValue","onUpdate:modelValue"]),S(" SKU ")]),_:2},1024),e(k,{label:"\u62E3\u8D27\u5355\u4F4D\u540D"},{default:u(()=>[e(f,{modelValue:o.picking_unit_name,"onUpdate:modelValue":h=>o.picking_unit_name=h},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(k,{label:"\u6DFB\u52A0pkg\u6253\u5305"},{default:u(()=>[e(n,{modelValue:o.support_pkg_picking,"onUpdate:modelValue":h=>o.support_pkg_picking=h},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),o.support_pkg_picking?(b(),A(k,{key:0,label:"1 PKG ="},{default:u(()=>[e(l,{modelValue:o.pkg_picking_unit,"onUpdate:modelValue":h=>o.pkg_picking_unit=h},null,8,["modelValue","onUpdate:modelValue"]),S(" SKU ")]),_:2},1024)):w("v-if",!0),o.support_pkg_picking?(b(),A(k,{key:1,label:"PKG\u6253\u5305\u5355\u4F4D"},{default:u(()=>[e(f,{modelValue:o.pkg_picking_unit_name,"onUpdate:modelValue":h=>o.pkg_picking_unit_name=h},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)):w("v-if",!0),e(k,{label:"\u62E3\u8D27sku\u540D"},{default:u(()=>[e(f,{modelValue:o.picking_sku_name,"onUpdate:modelValue":h=>o.picking_sku_name=h},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),w("          <t-form-item>"),w('            <t-button theme="default" @click="onClose">\u5173\u95ED</t-button>'),w('            <t-button :disabled="isLoading" theme="primary" @click="onSubmitPrintOrder">\u786E\u8BA4 & \u63D0\u4EA4\u6253\u5370</t-button>'),w("          </t-form-item>")]),_:1})]),_:1},8,["loading"])]),_:1},8,["visible"])):w("v-if",!0),e(W,{ref_key:"orderPrintProgressDialog",ref:D},null,512)])}}});var G=z(de,[["__file","/Users/jkguo/workspace/ec-erp-static/src/pages/warehouse/components/orderPrintConfirmDialog.vue"]]);const Q=C=>(te("data-v-cf49c91e"),C=C(),ue(),C),fe=Q(()=>x("br",null,null,-1)),me=Q(()=>x("br",null,null,-1)),ge={class:"table-container"},ke={name:"PrintOrder",components:{OrderPrintConfirmDialog:G}},ve=M({...ke,setup(C){const U=r("\u672A\u767B\u5F55"),D=r(null),g=[{width:50,colKey:"row-select",type:"multiple",checkProps:{allowUncheck:!0},align:"center"},{width:120,colKey:"id",title:"id",align:"center"},{width:60,colKey:"platformOrderId",title:"\u8BA2\u5355\u53F7",align:"center"},{width:120,colKey:"packageNo",title:"\u5305\u88F9\u53F7",align:"center"},{width:120,colKey:"shippingCarrierName",title:"\u7269\u6D41",align:"center"},{width:120,colKey:"trackingNo",title:"\u8FD0\u5355\u53F7",align:"center"},{width:120,colKey:"multilingualViewStatus",title:"\u72B6\u6001",align:"center"},{width:120,colKey:"amount",title:"\u91D1\u989D",align:"center"},{width:120,colKey:"platform",title:"\u5E73\u53F0",align:"center"}],s=r([]),p=r(!1),E=r([]),d=r(1),B=r(0),P=r(500),$=[10,20,50,100,200,500,1e3],V=r([]),v=r(null);Y(async()=>{const{query:l}=Z(),{token:n}=l;try{const c=await ee(n);U.value=c.userName,await F()}catch(c){console.error(c),await m.error(`\u767B\u9646\u5F02\u5E38: ${c}`)}});const F=async()=>{try{const n=(await ie()).ship_provider_list;console.log("shipProviderList",n),V.value=[],n.forEach(c=>{V.value.push({label:`${c.name}(${c.count})`,value:c.id})})}catch(l){console.error(l),await m.error(`\u67E5\u8BE2\u8BA2\u5355\u7EDF\u8BA1\u4FE1\u606F\u5F02\u5E38: ${l}`)}},i=(l,n)=>{D.value=l,k()},t=(l,{selectedRowData:n})=>{E.value=l},f=({current:l,pageSize:n})=>{d.value=l,P.value=n,k()},k=async()=>{if(p.value=!0,await F(),D.value===null){p.value=!1;return}try{const l={shipping_provider_id:D.value,current_page:d.value,page_size:P.value};E.value=[];const n=await re(l);B.value=n.total,s.value=n.list,console.log("waitOrder",B.value,s.value)}catch(l){console.error(l),await m.error(`\u67E5\u8BE2\u8BA2\u5355\u4FE1\u606F\u5F02\u5E38: ${l}`)}p.value=!1},T=async()=>{const l=new Set;if(E.value.forEach(c=>{l.add(c)}),console.log("selected: ",l),l.size<=0){m.info("\u8BF7\u5148\u9009\u4E2D\u9700\u8981\u6253\u5370\u7684\u8BA2\u5355.");return}const n=[];if(s.value.forEach(c=>{l.has(c.id)&&n.push(c)}),n.length!=l.size){m.error("\u9009\u4E2D\u7684\u8BA2\u5355\u4FE1\u606F\u7F3A\u5931\u3002.");return}v.value.popupDialog(B.value,n)};return(l,n)=>{const c=a("t-radio"),O=a("t-space"),_=a("t-radio-group"),I=a("t-form-item"),L=a("t-button"),N=a("t-form"),o=a("t-col"),h=a("t-row"),H=a("t-table"),J=a("t-pagination"),X=a("t-card");return b(),K("div",null,[e(X,null,{default:u(()=>[fe,e(h,null,{default:u(()=>[e(o,{span:12},{default:u(()=>[e(N,{layout:"inline"},{default:u(()=>[e(I,{label:"\u7269\u6D41\u65B9\u5F0F"},{default:u(()=>[e(_,{modelValue:D.value,"onUpdate:modelValue":n[0]||(n[0]=y=>D.value=y),name:"shipping",variant:"default-filled",onChange:i},{default:u(()=>[e(O,{direction:"vertical"},{default:u(()=>[(b(!0),K(j,null,R(V.value,y=>(b(),A(c,{value:y.value},{default:u(()=>[S(q(y.label),1)]),_:2},1032,["value"]))),256))]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(I,null,{default:u(()=>[e(O,{size:"small",style:{"align-items":"center","margin-left":"30px"}},{default:u(()=>[e(L,{theme:"default",onClick:k},{default:u(()=>[S("\u5237 \u65B0")]),_:1}),e(L,{theme:"primary",onClick:T},{default:u(()=>[S("\u6253 \u5370")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),me,x("div",ge,[e(H,{columns:g,data:s.value,loading:p.value,"select-on-row-click":!0,"selected-row-keys":E.value,bordered:"",hover:"","row-key":"id",stripe:"",onSelectChange:t},{multilingualViewStatus:u(({row:y})=>[S(q(y.printLabelMark>0?"[\u5DF2\u6253\u5370]"+y.multilingualViewStatus:y.multilingualViewStatus),1)]),_:1},8,["data","loading","selected-row-keys"]),e(J,{modelValue:d.value,"onUpdate:modelValue":n[1]||(n[1]=y=>d.value=y),pageSize:P.value,"onUpdate:pageSize":n[2]||(n[2]=y=>P.value=y),"page-size-options":$,total:B.value,class:"pagination",onChange:f},null,8,["modelValue","pageSize","total"])])]),_:1}),e(G,{ref_key:"orderPrintConfirmDialog",ref:v},null,512)])}}});var be=z(ve,[["__scopeId","data-v-cf49c91e"],["__file","/Users/jkguo/workspace/ec-erp-static/src/pages/warehouse/printOrder.vue"]]);export{be as default};
